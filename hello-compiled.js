this.createjs=this.createjs||{};
(function(){function a(){throw"SoundJS cannot be instantiated";}function b(a,b){this.init(a,b)}function c(){}a.DELIMITER="|";a.AUDIO_TIMEOUT=8E3;a.INTERRUPT_ANY="any";a.INTERRUPT_EARLY="early";a.INTERRUPT_LATE="late";a.INTERRUPT_NONE="none";a.PLAY_INITED="playInited";a.PLAY_SUCCEEDED="playSucceeded";a.PLAY_INTERRUPTED="playInterrupted";a.PLAY_FINISHED="playFinished";a.PLAY_FAILED="playFailed";a.activePlugin=null;a.muted=!1;a.pluginsRegistered=!1;a.masterVolume=1;a.instances=[];a.instanceHash={};a.idHash=
null;a.defaultSoundInstance=null;a.getPreloadHandlers=function(){return{callback:a.proxy(a.initLoad,a),types:["sound"],extensions:["mp3","ogg","wav"]}};a.registerPlugins=function(b){a.pluginsRegistered=!0;for(var c=0,g=b.length;c<g;c++){var d=b[c];if(null!=d&&d.isSupported())return a.activePlugin=new d,!0}return!1};a.registerPlugin=function(b){a.pluginsRegistered=!0;return null==b?!1:b.isSupported()?(a.activePlugin=new b,!0):!1};a.isReady=function(){return null!=a.activePlugin};a.getCapabilities=
function(){return null==a.activePlugin?null:a.activePlugin.capabilities};a.getCapability=function(b){return null==a.activePlugin?null:a.activePlugin.capabilities[b]};a.initLoad=function(e,c,g,d){if(!a.checkPlugin(!0))return!1;e=a.parsePath(e,c,g,d);if(null==e)return!1;null!=g&&(null==a.idHash&&(a.idHash={}),a.idHash[g]=e.src);b.create(e.src,d);g=a.activePlugin.register(e.src,d);null!=g&&(null!=g.tag?e.tag=g.tag:g.src&&(e.src=g.src),null!=g.completeHandler&&(e.handler=g.completeHandler));return e};
a.parsePath=function(b,c,g,d){b=b.split(a.DELIMITER);c={type:c||"sound",id:g,data:d,handler:a.handleSoundReady};g=!1;d=a.getCapabilities();for(var h=0,k=b.length;h<k;h++){var m=b[h],j=m.lastIndexOf("."),n=m.substr(j+1).toLowerCase(),j=m.substr(0,j).split("/").pop();switch(n){case "mp3":d.mp3&&(g=!0);break;case "ogg":d.ogg&&(g=!0);break;case "wav":d.wav&&(g=!0)}if(g)return c.name=j,c.src=m,c.extension=n,c}return null};a.play=function(b,c,g,d,h,k,m){if(!a.checkPlugin(!0))return a.defaultSoundInstance;
b=a.getSrcFromId(b);b=a.activePlugin.create(b);try{b.mute(a.muted)}catch(j){}a.playInstance(b,c,g,d,h,k,m)||b.playFailed();return b};a.playInstance=function(b,c,g,d,h,k,m){c=c||a.INTERRUPT_NONE;null==g&&(g=0);null==d&&(d=0);null==h&&(h=0);null==k&&(k=1);null==m&&(m=0);if(0==g){if(!a.beginPlaying(b,c,d,h,k,m))return!1}else setTimeout(function(){a.beginPlaying(b,c,d,h,k,m)},g);this.instances.push(b);this.instanceHash[b.uniqueId]=b;return!0};a.beginPlaying=function(a,c,g,d,h,k){return!b.add(a,c)?!1:
!a.beginPlaying(g,d,h,k)?(this.instances.splice(this.instances.indexOf(a),1),delete this.instanceHash[a.uniqueId],!1):!0};a.checkPlugin=function(b){return null==a.activePlugin&&(b&&!a.pluginsRegistered&&a.registerPlugin(createjs.HTMLAudioPlugin),null==a.activePlugin)?!1:!0};a.getSrcFromId=function(b){return null==a.idHash||null==a.idHash[b]?b:a.idHash[b]};a.setVolume=function(b,c){if(null==Number(b))return!1;b=Math.max(0,Math.min(1,b));return a.tellAllInstances("setVolume",c,b)};a.getMasterVolume=
function(){return a.masterVolume};a.setMasterVolume=function(b){a.masterVolume=b;return a.tellAllInstances("setMasterVolume",null,b)};a.setMute=function(b){this.muted=b;return a.tellAllInstances("mute",null,b)};a.pause=function(b){return a.tellAllInstances("pause",b)};a.resume=function(b){return a.tellAllInstances("resume",b)};a.stop=function(b){return a.tellAllInstances("stop",b)};a.getInstanceById=function(a){return this.instanceHash[a]};a.playFinished=function(a){b.remove(a);this.instances.splice(this.instances.indexOf(a),
1)};a.tellAllInstances=function(a,b,c){if(null==this.activePlugin)return!1;b=this.getSrcFromId(b);for(var d=this.instances.length-1;0<=d;d--){var h=this.instances[d];if(!(null!=b&&h.src!=b))switch(a){case "pause":h.pause();break;case "resume":h.resume();break;case "setVolume":h.setVolume(c);break;case "setMasterVolume":h.setMasterVolume(c);break;case "mute":h.mute(c);break;case "stop":h.stop();break;case "setPan":h.setPan(c)}}return!0};a.proxy=function(a,b){return function(){return a.apply(b,arguments)}};
createjs.SoundJS=a;b.channels={};b.create=function(a,c){var g=b.get(a);null==g?b.channels[a]=new b(a,c):g.max+=c};b.add=function(a,c){var g=b.get(a.src);return null==g?!1:g.add(a,c)};b.remove=function(a){var c=b.get(a.src);if(null==c)return!1;c.remove(a);return!0};b.get=function(a){return b.channels[a]};b.prototype={src:null,max:null,length:0,init:function(a,b){this.src=a;this.max=b||1;this.instances=[]},get:function(a){return this.instances[a]},add:function(a,b){if(!this.getSlot(b,a))return!1;this.instances.push(a);
this.length++;return!0},remove:function(a){a=this.instances.indexOf(a);if(-1==a)return!1;this.instances.splice(a,1);this.length--;return!0},getSlot:function(b){for(var c,g,d=0,h=this.max||100;d<h;d++){c=this.get(d);if(null==c)return!0;if(b!=a.INTERRUPT_NONE)if(0==d)g=c;else if(c.playState==a.PLAY_FINISHED||c==a.PLAY_INTERRUPTED||c==a.PLAY_FAILED)g=c;else if(b==a.INTERRUPT_EARLY&&c.getPosition()<g.getPosition()||b==a.INTERRUPT_LATE&&c.getPosition()>g.getPosition())g=c}return null!=g?(g.interrupt(),
this.remove(g),!0):!1},toString:function(){return"[SoundJS SoundChannel]"}};a.defaultSoundInstance=new function(){this.isDefault=!0;this.pause=this.resume=this.play=this.beginPlaying=this.cleanUp=this.interrupt=this.stop=this.setMasterVolume=this.setVolume=this.mute=this.setPan=this.getPosition=this.setPosition=this.playFailed=function(){return!1};this.getVolume=this.getPan=this.getDuration=function(){return 0};this.playState=a.PLAY_FAILED;this.toString=function(){return"[SoundJS Default Sound Instance]"}};
c.init=function(){var a=navigator.userAgent;c.isFirefox=-1<a.indexOf("Firefox");c.isOpera=null!=window.opera;c.isIOS=-1<a.indexOf("iPod")||-1<a.indexOf("iPhone")||-1<a.indexOf("iPad")};c.init();createjs.SoundJS.BrowserDetect=c})();this.createjs=this.createjs||{};
(function(){function a(){this.init()}function b(a){this.init(a)}function c(a){this.init(a)}a.MAX_INSTANCES=30;a.capabilities=null;a.lastId=0;a.AUDIO_READY="canplaythrough";a.AUDIO_ENDED="ended";a.AUDIO_ERROR="error";a.AUDIO_STALLED="stalled";a.fillChannels=!1;a.isSupported=function(){if(createjs.SoundJS.BrowserDetect.isIOS)return!1;a.generateCapabilities();return null==a.tag?!1:!0};a.generateCapabilities=function(){if(null==a.capabilities){var b=a.tag=document.createElement("audio");if(null==b.canPlayType)return null;
a.capabilities={panning:!1,volume:!0,mp3:"no"!=b.canPlayType("audio/mp3")&&""!=b.canPlayType("audio/mp3"),ogg:"no"!=b.canPlayType("audio/ogg")&&""!=b.canPlayType("audio/ogg"),mpeg:"no"!=b.canPlayType("audio/mpeg")&&""!=b.canPlayType("audio/mpeg"),wav:"no"!=b.canPlayType("audio/wav")&&""!=b.canPlayType("audio/wav"),channels:a.MAX_INSTANCES}}};a.prototype={capabilities:null,FT:0.001,channels:null,init:function(){this.capabilities=a.capabilities;this.channels={}},register:function(a,b){for(var g=c.get(a),
d,h=0,k=b||1;h<k;h++)d=this.createTag(a),g.add(d);return{tag:d}},createTag:function(a){var b=document.createElement("audio");b.preload=!1;b.src=a;return b},create:function(a){a=new b(a);a.owner=this;return a},toString:function(){return"[HTMLAudioPlugin]"}};createjs.HTMLAudioPlugin=a;b.prototype={src:null,uniqueId:-1,playState:null,owner:null,loaded:!1,lastInterrupt:createjs.SoundJS.INTERRUPT_NONE,offset:0,delay:0,volume:1,pan:0,remainingLoops:0,delayTimeout:-1,tag:null,muted:!1,paused:!1,onComplete:null,
onLoop:null,onReady:null,onPlayFailed:null,onPlayInterrupted:null,endedHandler:null,readyHandler:null,stalledHandler:null,init:function(a){this.uniqueId=createjs.HTMLAudioPlugin.lastId++;this.src=a;this.endedHandler=createjs.SoundJS.proxy(this.handleSoundComplete,this);this.readyHandler=createjs.SoundJS.proxy(this.handleSoundReady,this);this.stalledHandler=createjs.SoundJS.proxy(this.handleSoundStalled,this)},cleanUp:function(){var a=this.tag;if(null!=a){a.pause();try{a.currentTime=0}catch(b){}a.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_ENDED,
this.endedHandler,!1);a.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1);c.setInstance(this.src,a);this.tag=null}null!=window.createjs&&createjs.SoundJS.playFinished(this)},interrupt:function(){if(null!=this.tag){this.playState=createjs.SoundJS.PLAY_INTERRUPTED;if(this.onPlayInterrupted)this.onPlayInterrupted(this);this.cleanUp();this.paused=!1}},play:function(a,b,c,d,h,k){this.cleanUp();createjs.SoundJS.playInstance(this,a,b,c,d,h,k)},beginPlaying:function(a,b,g){if(null!=
window.createjs){var d=this.tag=c.getInstance(this.src);if(null==d)return this.playFailed(),-1;d.addEventListener(createjs.HTMLAudioPlugin.AUDIO_ENDED,this.endedHandler,!1);this.offset=a;this.volume=g;this.updateVolume();this.remainingLoops=b;4!==d.readyState?(d.addEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1),d.addEventListener(createjs.HTMLAudioPlugin.AUDIO_STALLED,this.stalledHandler,!1),d.load()):this.handleSoundReady(null);return 1}},handleSoundStalled:function(){if(null!=
this.onPlayFailed)this.onPlayFailed(this);this.cleanUp()},handleSoundReady:function(){null!=window.createjs&&((this.playState=createjs.SoundJS.PLAY_SUCCEEDED,this.paused=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin.AUDIO_READY,this.readyHandler,!1),this.offset>=this.getDuration())?this.playFailed():(0<this.offset&&(this.tag.currentTime=0.001*this.offset),-1==this.remainingLoops&&(this.tag.loop=!0),this.tag.play()))},pause:function(){this.paused=!0;return null!=this.tag?(this.tag.pause(),
!1):!0},resume:function(){this.paused=!1;return null!=this.tag?(this.tag.play(),!1):!0},stop:function(){this.pause();this.playState=createjs.SoundJS.PLAY_FINISHED;this.cleanUp();return!0},setMasterVolume:function(){this.updateVolume();return!0},setVolume:function(a){this.volume=a;this.updateVolume();return!0},updateVolume:function(){return null!=this.tag?(this.tag.volume=this.muted?0:this.volume*createjs.SoundJS.masterVolume,!0):!1},getVolume:function(){return this.volume},mute:function(a){this.muted=
a;this.updateVolume();return!0},setPan:function(){return!1},getPan:function(){return 0},getPosition:function(){return null==this.tag?0:1E3*this.tag.currentTime},setPosition:function(a){if(null==this.tag)return!1;try{this.tag.currentTime=0.001*a}catch(b){return!1}return!0},getDuration:function(){return null==this.tag?0:1E3*this.tag.duration},handleSoundComplete:function(){if(0!=this.remainingLoops){if(this.remainingLoops--,this.tag.play(),null!=this.onLoop)this.onLoop(this)}else if(null!=window.createjs){this.playState=
createjs.SoundJS.PLAY_FINISHED;if(null!=this.onComplete)this.onComplete(this);this.cleanUp()}},playFailed:function(){if(null!=window.createjs){this.playState=createjs.SoundJS.PLAY_FAILED;if(null!=this.onPlayFailed)this.onPlayFailed(this);this.cleanUp()}},toString:function(){return"[HTMLAudioPlugin SoundInstance]"}};c.channels={};c.get=function(a){var b=c.channels[a];null==b&&(b=c.channels[a]=new c(a));return b};c.getInstance=function(a){a=c.channels[a];return null==a?null:a.get()};c.setInstance=function(a,
b){var g=c.channels[a];return null==g?null:g.set(b)};c.prototype={src:null,length:0,available:0,tags:null,init:function(a){this.src=a;this.tags=[]},add:function(a){this.tags.push(a);this.length++;this.available=this.tags.length},get:function(){if(0==this.tags.length)return null;this.available=this.tags.length;var a=this.tags.pop();document.body.appendChild(a);return a},set:function(a){-1==this.tags.indexOf(a)&&this.tags.push(a);document.body.removeChild(a);this.available=this.tags.length},toString:function(){return"[HTMLAudioPlugin TagChannel]"}}})();(function(a,b){function c(){return!0}function e(){return!1}var f=a.document;f.createElement("video");f.createElement("audio");var g=function(a,b,c){if("string"==typeof a){0===a.indexOf("#")&&(a=a.slice(1));if(d.players[a])return d.players[a];a=d.el(a)}if(!a||!a.nodeName)throw log("VideoJS error #######",a,a.nodeName),new TypeError("The element or ID supplied is not valid. (VideoJS)");return a.player||new d.Player(a,b,c)},d=g;g.players={};g.options={techOrder:["html5","flash"],html5:{},flash:{swf:"http://vjs.zencdn.net/c/video-js.swf"},
width:"auto",height:"auto",defaultVolume:0,components:{posterImage:{},textTrackDisplay:{},loadingSpinner:{},bigPlayButton:{},controlBar:{}}};d.options.flash.swf="http://vjs.zencdn.net/3.2/video-js.swf";d.merge=function(a,b,d){b||(b={});for(var c in b)if(b.hasOwnProperty(c)&&(!d||!a.hasOwnProperty(c)))a[c]=b[c];return a};d.extend=function(a){this.merge(this,a,!0)};d.extend({tech:{},controlSets:{},isIE:function(){return!+"\v1"},isFF:function(){return!!d.ua.match("Firefox")},isIPad:function(){return null!==
navigator.userAgent.match(/iPad/i)},isIPhone:function(){return null!==navigator.userAgent.match(/iPhone/i)},isIOS:function(){return g.isIPhone()||g.isIPad()},iOSVersion:function(){var a=navigator.userAgent.match(/OS (\d+)_/i);if(a&&a[1])return a[1]},isAndroid:function(){return null!==navigator.userAgent.match(/Android.*AppleWebKit/i)},androidVersion:function(){var a=navigator.userAgent.match(/Android (\d+)\./i);if(a&&a[1])return a[1]},testVid:f.createElement("video"),ua:navigator.userAgent,support:{},
each:function(a,b){if(a&&0!==a.length)for(var d=0,c=a.length;d<c;d++)b.call(this,a[d],d)},eachProp:function(a,b){if(a)for(var d in a)a.hasOwnProperty(d)&&b.call(this,d,a[d])},el:function(a){return f.getElementById(a)},createElement:function(a,b){var d=f.createElement(a),c;for(c in b)b.hasOwnProperty(c)&&(-1!==c.indexOf("-")?d.setAttribute(c,b[c]):d[c]=b[c]);return d},insertFirst:function(a,b){b.firstChild?b.insertBefore(a,b.firstChild):b.appendChild(a)},addClass:function(a,b){-1==(" "+a.className+
" ").indexOf(" "+b+" ")&&(a.className=""===a.className?b:a.className+" "+b)},removeClass:function(a,b){if(-1!=a.className.indexOf(b)){var d=a.className.split(" ");d.splice(d.indexOf(b),1);a.className=d.join(" ")}},remove:function(a,b){if(b){var d=b.indexOf(a);if(-1!=d)return b.splice(d,1)}},blockTextSelection:function(){f.body.focus();f.onselectstart=function(){return!1}},unblockTextSelection:function(){f.onselectstart=function(){return!0}},formatTime:function(a,b){b=b||a;var d=Math.floor(a%60),c=
Math.floor(a/60%60),e=Math.floor(a/3600),f=Math.floor(b/60%60),g=Math.floor(b/3600),e=0<e||0<g?e+":":"";return e+(((e||10<=f)&&10>c?"0"+c:c)+":")+(10>d?"0"+d:d)},uc:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},getRelativePosition:function(a,b){return Math.max(0,Math.min(1,(a-d.findPosX(b))/b.offsetWidth))},getComputedStyleValue:function(b,d){return a.getComputedStyle(b,null).getPropertyValue(d)},trim:function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,"")},round:function(a,
b){b||(b=0);return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},isEmpty:function(a){for(var b in a)return!1;return!0},createTimeRange:function(a,b){return{length:1,start:function(){return a},end:function(){return b}}},cache:{},guid:1,expando:"vdata"+(new Date).getTime(),getData:function(a){var b=a[d.expando];b||(b=a[d.expando]=d.guid++,d.cache[b]={});return d.cache[b]},removeData:function(a){var b=a[d.expando];if(b){delete d.cache[b];try{delete a[d.expando]}catch(c){a.removeAttribute?a.removeAttribute(d.expando):
a[d.expando]=null}}},proxy:function(a,b,c){b.guid||(b.guid=d.guid++);var e=function(){return b.apply(a,arguments)};e.guid=c?c+"_"+b.guid:b.guid;return e},get:function(b,c,e){var f=0==b.indexOf("file:")||0==a.location.href.indexOf("file:")&&-1==b.indexOf("http:");"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(p){}throw Error("This browser does not support XMLHttpRequest.");
});var g=new XMLHttpRequest;try{g.open("GET",b)}catch(h){return d.log("VideoJS XMLHttpRequest (open)",h),!1}g.onreadystatechange=d.proxy(this,function(){4==g.readyState&&(200==g.status||f&&0==g.status?c(g.responseText):e&&e())});try{g.send()}catch(w){d.log("VideoJS XMLHttpRequest (send)",w),e&&e(w)}},setLocalStorage:function(b,c){var e=a.localStorage||!1;if(e)try{e[b]=c}catch(f){22==f.code||1014==f.code?d.log("LocalStorage Full (VideoJS)",f):d.log("LocalStorage Error (VideoJS)",f)}},getAbsoluteURL:function(a){a.match(/^https?:\/\//)||
(a=d.createElement("div",{innerHTML:'<a href="'+a+'">x</a>'}).firstChild.href);return a}});d.log=function(){d.log.history=d.log.history||[];d.log.history.push(arguments);if(a.console){arguments.callee=arguments.callee.caller;var b=[].slice.call(arguments);"object"===typeof console.log?d.log.apply.call(console.log,console,b):console.log.apply(console,b)}};var h;try{console.log(),h=a.console}catch(k){h=a.console={}}for(var m=function(){},j="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log timeStamp profile profileEnd time timeEnd trace warn".split(" "),
n;n=j.pop();)h[n]=h[n]||m;d.findPosX="getBoundingClientRect"in f.documentElement?function(b){var d;try{d=b.getBoundingClientRect()}catch(c){}if(!d)return 0;b=f.body;return d.left+(a.pageXOffset||b.scrollLeft)-(f.documentElement.clientLeft||b.clientLeft||0)}:function(a){for(var b=a.offsetLeft;a=obj.offsetParent;)a.className.indexOf("video-js"),b+=a.offsetLeft;return b};var l=!1,r=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;d.Class=function(){};d.Class.extend=function(a){function b(){if(!l&&this.init)return this.init.apply(this,
arguments);if(!l)return arguments.callee.prototype.init()}var d=this.prototype;l=!0;var c=new this;l=!1;for(var e in a)c[e]="function"==typeof a[e]&&"function"==typeof d[e]&&r.test(a[e])?function(a,b){return function(){var p=this._super;this._super=d[a];var c=b.apply(this,arguments);this._super=p;return c}}(e,a[e]):a[e];b.prototype=c;b.constructor=b;b.extend=arguments.callee;return b};d.Component=d.Class.extend({init:function(a,b){this.player=a;b=this.options=d.merge(this.options||{},b);this.el=b.el?
b.el:this.createElement();this.initComponents()},destroy:function(){},createElement:function(a,b){return d.createElement(a||"div",b)},buildCSSClass:function(){return""},initComponents:function(){var a=this.options;a&&a.components&&this.eachProp(a.components,function(a,b){var p=this.proxy(function(){this[a]=this.addComponent(a,b)});if(b.loadEvent)this.one(b.loadEvent,p);else p()})},addComponent:function(a,b){var c;"string"==typeof a?(b=b||{},c=b.componentClass||d.uc(a),c=new d[c](this.player||this,
b)):c=a;this.el.appendChild(c.el);return c},removeComponent:function(a){this.el.removeChild(a.el)},show:function(){this.el.style.display="block"},hide:function(){this.el.style.display="none"},fadeIn:function(){this.removeClass("vjs-fade-out");this.addClass("vjs-fade-in")},fadeOut:function(){this.removeClass("vjs-fade-in");this.addClass("vjs-fade-out")},lockShowing:function(){var a=this.el.style;a.display="block";a.opacity=1;a.visiblity="visible"},unlockShowing:function(){var a=this.el.style;a.display=
"";a.opacity="";a.visiblity=""},addClass:function(a){d.addClass(this.el,a)},removeClass:function(a){d.removeClass(this.el,a)},addEvent:function(a,b){return d.addEvent(this.el,a,d.proxy(this,b))},removeEvent:function(a,b){return d.removeEvent(this.el,a,b)},triggerEvent:function(a,b){return d.triggerEvent(this.el,a,b)},one:function(a,b){d.one(this.el,a,d.proxy(this,b))},ready:function(a){if(!a)return this;this.isReady?a.call(this):(this.readyQueue===b&&(this.readyQueue=[]),this.readyQueue.push(a));
return this},triggerReady:function(){this.isReady=!0;this.readyQueue&&0<this.readyQueue.length&&(this.each(this.readyQueue,function(a){a.call(this)}),this.readyQueue=[],this.triggerEvent("ready"))},each:function(a,b){d.each.call(this,a,b)},eachProp:function(a,b){d.eachProp.call(this,a,b)},extend:function(a){d.merge(this,a)},proxy:function(a,b){return d.proxy(this,a,b)}});d.Control=d.Component.extend({buildCSSClass:function(){return"vjs-control "+this._super()}});d.ControlBar=d.Component.extend({options:{loadEvent:"play",
components:{playToggle:{},fullscreenToggle:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{},remainingTimeDisplay:{},progressControl:{},volumeControl:{},muteToggle:{}}},init:function(a,b){this._super(a,b);a.addEvent("play",this.proxy(function(){this.fadeIn();this.player.addEvent("mouseover",this.proxy(this.fadeIn));this.player.addEvent("mouseout",this.proxy(this.fadeOut))}))},createElement:function(){return d.createElement("div",{className:"vjs-controls"})},fadeIn:function(){this._super();
this.player.triggerEvent("controlsvisible")},fadeOut:function(){this._super();this.player.triggerEvent("controlshidden")},lockShowing:function(){this.el.style.opacity="1"}});d.Button=d.Control.extend({init:function(a,b){this._super(a,b);this.addEvent("click",this.onClick);this.addEvent("focus",this.onFocus);this.addEvent("blur",this.onBlur)},createElement:function(a,b){b=d.merge({className:this.buildCSSClass(),innerHTML:'<div><span class="vjs-control-text">'+(this.buttonText||"Need Text")+"</span></div>",
role:"button",tabIndex:0},b);return this._super(a,b)},onClick:function(){},onFocus:function(){d.addEvent(f,"keyup",d.proxy(this,this.onKeyPress))},onKeyPress:function(a){if(32==a.which||13==a.which)a.preventDefault(),this.onClick()},onBlur:function(){d.removeEvent(f,"keyup",d.proxy(this,this.onKeyPress))}});d.PlayButton=d.Button.extend({buttonText:"Play",buildCSSClass:function(){return"vjs-play-button "+this._super()},onClick:function(){this.player.play()}});d.PauseButton=d.Button.extend({buttonText:"Pause",
buildCSSClass:function(){return"vjs-pause-button "+this._super()},onClick:function(){this.player.pause()}});d.PlayToggle=d.Button.extend({buttonText:"Play",init:function(a,b){this._super(a,b);a.addEvent("play",d.proxy(this,this.onPlay));a.addEvent("pause",d.proxy(this,this.onPause))},buildCSSClass:function(){return"vjs-play-control "+this._super()},onClick:function(){this.player.paused()?this.player.play():this.player.pause()},onPlay:function(){d.removeClass(this.el,"vjs-paused");d.addClass(this.el,
"vjs-playing")},onPause:function(){d.removeClass(this.el,"vjs-playing");d.addClass(this.el,"vjs-paused")}});d.FullscreenToggle=d.Button.extend({buttonText:"Fullscreen",buildCSSClass:function(){return"vjs-fullscreen-control "+this._super()},onClick:function(){this.player.isFullScreen?this.player.cancelFullScreen():this.player.requestFullScreen()}});d.BigPlayButton=d.Button.extend({init:function(a,b){this._super(a,b);a.addEvent("play",d.proxy(this,this.hide));a.addEvent("ended",d.proxy(this,this.show))},
createElement:function(){return this._super("div",{className:"vjs-big-play-button",innerHTML:"<span></span>"})},onClick:function(){this.player.currentTime()&&this.player.currentTime(0);this.player.play()}});d.LoadingSpinner=d.Component.extend({init:function(a,b){this._super(a,b);a.addEvent("canplay",d.proxy(this,this.hide));a.addEvent("canplaythrough",d.proxy(this,this.hide));a.addEvent("playing",d.proxy(this,this.hide));a.addEvent("seeking",d.proxy(this,this.show));a.addEvent("error",d.proxy(this,
this.show));a.addEvent("waiting",d.proxy(this,this.show))},createElement:function(){var a,b;"string"==typeof this.player.el.style.WebkitBorderRadius||"string"==typeof this.player.el.style.MozBorderRadius||"string"==typeof this.player.el.style.KhtmlBorderRadius||"string"==typeof this.player.el.style.borderRadius?(a="vjs-loading-spinner",b="<div class='ball1'></div><div class='ball2'></div><div class='ball3'></div><div class='ball4'></div><div class='ball5'></div><div class='ball6'></div><div class='ball7'></div><div class='ball8'></div>"):
(a="vjs-loading-spinner-fallback",b="");return this._super("div",{className:a,innerHTML:b})}});d.CurrentTimeDisplay=d.Component.extend({init:function(a,b){this._super(a,b);a.addEvent("timeupdate",d.proxy(this,this.updateContent))},createElement:function(){var a=this._super("div",{className:"vjs-current-time vjs-time-controls vjs-control"});this.content=d.createElement("div",{className:"vjs-current-time-display",innerHTML:"0:00"});a.appendChild(d.createElement("div").appendChild(this.content));return a},
updateContent:function(){var a=this.player.scrubbing?this.player.values.currentTime:this.player.currentTime();this.content.innerHTML=d.formatTime(a,this.player.duration())}});d.DurationDisplay=d.Component.extend({init:function(a,b){this._super(a,b);a.addEvent("timeupdate",d.proxy(this,this.updateContent))},createElement:function(){var a=this._super("div",{className:"vjs-duration vjs-time-controls vjs-control"});this.content=d.createElement("div",{className:"vjs-duration-display",innerHTML:"0:00"});
a.appendChild(d.createElement("div").appendChild(this.content));return a},updateContent:function(){this.player.duration()&&(this.content.innerHTML=d.formatTime(this.player.duration()))}});d.TimeDivider=d.Component.extend({createElement:function(){return this._super("div",{className:"vjs-time-divider",innerHTML:"<div><span>/</span></div>"})}});d.RemainingTimeDisplay=d.Component.extend({init:function(a,b){this._super(a,b);a.addEvent("timeupdate",d.proxy(this,this.updateContent))},createElement:function(){var a=
this._super("div",{className:"vjs-remaining-time vjs-time-controls vjs-control"});this.content=d.createElement("div",{className:"vjs-remaining-time-display",innerHTML:"-0:00"});a.appendChild(d.createElement("div").appendChild(this.content));return a},updateContent:function(){this.player.duration()&&(this.content.innerHTML="-"+d.formatTime(this.player.remainingTime()))}});d.Slider=d.Component.extend({init:function(a,b){this._super(a,b);a.addEvent(this.playerEvent,d.proxy(this,this.update));this.addEvent("mousedown",
this.onMouseDown);this.addEvent("focus",this.onFocus);this.addEvent("blur",this.onBlur);this.player.addEvent("controlsvisible",this.proxy(this.update));this.update()},createElement:function(a,b){b=d.merge({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},b);return this._super(a,b)},onMouseDown:function(a){a.preventDefault();d.blockTextSelection();d.addEvent(f,"mousemove",d.proxy(this,this.onMouseMove));d.addEvent(f,"mouseup",d.proxy(this,this.onMouseUp));this.onMouseMove(a)},
onMouseUp:function(){d.unblockTextSelection();d.removeEvent(f,"mousemove",this.onMouseMove,!1);d.removeEvent(f,"mouseup",this.onMouseUp,!1);this.update()},update:function(){var a,b=this.getPercent();handle=this.handle;bar=this.bar;isNaN(b)&&(b=0);a=b;if(handle){a=this.el.offsetWidth;var c=handle.el.offsetWidth;a=c?c/a:0;adjustedProgress=b*(1-a);a=adjustedProgress+a/2;handle.el.style.left=d.round(100*adjustedProgress,2)+"%"}bar.el.style.width=d.round(100*a,2)+"%"},calculateDistance:function(a){var b=
this.el,c=d.findPosX(b),b=b.offsetWidth,e=this.handle;e&&(e=e.el.offsetWidth,c+=e/2,b-=e);return Math.max(0,Math.min(1,(a.pageX-c)/b))},onFocus:function(){d.addEvent(f,"keyup",d.proxy(this,this.onKeyPress))},onKeyPress:function(a){37==a.which?(a.preventDefault(),this.stepBack()):39==a.which&&(a.preventDefault(),this.stepForward())},onBlur:function(){d.removeEvent(f,"keyup",d.proxy(this,this.onKeyPress))}});d.ProgressControl=d.Component.extend({options:{components:{seekBar:{}}},createElement:function(){return this._super("div",
{className:"vjs-progress-control vjs-control"})}});d.SeekBar=d.Slider.extend({options:{components:{loadProgressBar:{},bar:{componentClass:"PlayProgressBar"},handle:{componentClass:"SeekHandle"}}},playerEvent:"timeupdate",init:function(a,b){this._super(a,b)},createElement:function(){return this._super("div",{className:"vjs-progress-holder"})},getPercent:function(){return this.player.currentTime()/this.player.duration()},onMouseDown:function(a){this._super(a);this.player.scrubbing=!0;this.videoWasPlaying=
!this.player.paused();this.player.pause()},onMouseMove:function(a){a=this.calculateDistance(a)*this.player.duration();a==this.player.duration()&&(a-=0.1);this.player.currentTime(a)},onMouseUp:function(a){this._super(a);this.player.scrubbing=!1;this.videoWasPlaying&&this.player.play()},stepForward:function(){this.player.currentTime(this.player.currentTime()+1)},stepBack:function(){this.player.currentTime(this.player.currentTime()-1)}});d.LoadProgressBar=d.Component.extend({init:function(a,b){this._super(a,
b);a.addEvent("progress",d.proxy(this,this.update))},createElement:function(){return this._super("div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text">Loaded: 0%</span>'})},update:function(){this.el.style&&(this.el.style.width=d.round(100*this.player.bufferedPercent(),2)+"%")}});d.PlayProgressBar=d.Component.extend({createElement:function(){return this._super("div",{className:"vjs-play-progress",innerHTML:'<span class="vjs-control-text">Progress: 0%</span>'})}});d.SeekHandle=
d.Component.extend({createElement:function(){return this._super("div",{className:"vjs-seek-handle",innerHTML:'<span class="vjs-control-text">00:00</span>'})}});d.VolumeControl=d.Component.extend({options:{components:{volumeBar:{}}},createElement:function(){return this._super("div",{className:"vjs-volume-control vjs-control"})}});d.VolumeBar=d.Slider.extend({options:{components:{bar:{componentClass:"VolumeLevel"},handle:{componentClass:"VolumeHandle"}}},playerEvent:"volumechange",createElement:function(){return this._super("div",
{className:"vjs-volume-bar"})},onMouseMove:function(a){this.player.volume(this.calculateDistance(a))},getPercent:function(){return this.player.volume()},stepForward:function(){this.player.volume(this.player.volume()+0.1)},stepBack:function(){this.player.volume(this.player.volume()-0.1)}});d.VolumeLevel=d.Component.extend({createElement:function(){return this._super("div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})}});d.VolumeHandle=d.Component.extend({createElement:function(){return this._super("div",
{className:"vjs-volume-handle",innerHTML:'<span class="vjs-control-text"></span>'})}});d.MuteToggle=d.Button.extend({init:function(a,b){this._super(a,b);a.addEvent("volumechange",d.proxy(this,this.update))},createElement:function(){return this._super("div",{className:"vjs-mute-control vjs-control",innerHTML:'<div><span class="vjs-control-text">Mute</span></div>'})},onClick:function(){this.player.muted(this.player.muted()?!1:!0)},update:function(){var a=this.player.volume(),b=3;0==a||this.player.muted()?
b=0:0.33>a?b=1:0.67>a&&(b=2);d.each.call(this,[0,1,2,3],function(a){d.removeClass(this.el,"vjs-vol-"+a)});d.addClass(this.el,"vjs-vol-"+b)}});d.PosterImage=d.Button.extend({init:function(a,b){this._super(a,b);this.player.options.poster||this.hide();a.addEvent("play",d.proxy(this,this.hide))},createElement:function(){return d.createElement("img",{className:"vjs-poster",src:this.player.options.poster,tabIndex:-1})},onClick:function(){this.player.play()}});d.Menu=d.Component.extend({init:function(a,
b){this._super(a,b)},addItem:function(a){this.addComponent(a);a.addEvent("click",this.proxy(function(){this.unlockShowing()}))},createElement:function(){return this._super("ul",{className:"vjs-menu"})}});d.MenuItem=d.Button.extend({init:function(a,b){this._super(a,b);b.selected&&this.addClass("vjs-selected")},createElement:function(a,b){return this._super("li",d.merge({className:"vjs-menu-item",innerHTML:this.options.label},b))},onClick:function(){this.selected(!0)},selected:function(a){a?this.addClass("vjs-selected"):
this.removeClass("vjs-selected")}});Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),d=b.length>>>0;if(0===d)return-1;var c=0;0<arguments.length&&(c=Number(arguments[1]),c!==c?c=0:0!==c&&(c!==1/0&&c!==-(1/0))&&(c=(0<c||-1)*Math.floor(Math.abs(c))));if(c>=d)return-1;for(c=0<=c?c:Math.max(d-Math.abs(c),0);c<d;c++)if(c in b&&b[c]===a)return c;return-1});d.extend({addEvent:function(a,b,c){var e=d.getData(a),g;e&&!e.handler&&
(e.handler=function(b){b=d.fixEvent(b);var c=d.getData(a).events[b.type];if(c){var e=[];d.each(c,function(a,b){e[b]=a});for(var c=0,f=e.length;c<f;c++)e[c].call(a,b)}});e.events||(e.events={});g=e.events[b];g||(g=e.events[b]=[],f.addEventListener?a.addEventListener(b,e.handler,!1):f.attachEvent&&a.attachEvent("on"+b,e.handler));c.guid||(c.guid=d.guid++);g.push(c)},removeEvent:function(a,b,c){var e=d.getData(a);if(e.events)if(b){if(e=e.events[b]){if(c&&c.guid)for(var f=0;f<e.length;f++)e[f].guid===
c.guid&&e.splice(f--,1);d.cleanUpEvents(a,b)}}else for(b in e.events)d.cleanUpEvents(a,b)},cleanUpEvents:function(a,b){var c=d.getData(a);0===c.events[b].length&&(delete c.events[b],f.removeEventListener?a.removeEventListener(b,c.handler,!1):f.detachEvent&&a.detachEvent("on"+b,c.handler));d.isEmpty(c.events)&&(delete c.events,delete c.handler);d.isEmpty(c)&&d.removeData(a)},fixEvent:function(a){if(a[d.expando])return a;var c=a;a=new d.Event(c);for(var e=d.Event.props.length,g;e;)g=d.Event.props[--e],
a[g]=c[g];a.target||(a.target=a.srcElement||f);3===a.target.nodeType&&(a.target=a.target.parentNode);!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement);null==a.pageX&&null!=a.clientX&&(e=a.target.ownerDocument||f,c=e.documentElement,e=e.body,a.pageX=a.clientX+(c&&c.scrollLeft||e&&e.scrollLeft||0)-(c&&c.clientLeft||e&&e.clientLeft||0),a.pageY=a.clientY+(c&&c.scrollTop||e&&e.scrollTop||0)-(c&&c.clientTop||e&&e.clientTop||0));if(null==a.which&&(null!=
a.charCode||null!=a.keyCode))a.which=null!=a.charCode?a.charCode:a.keyCode;!a.metaKey&&a.ctrlKey&&(a.metaKey=a.ctrlKey);!a.which&&a.button!==b&&(a.which=a.button&1?1:a.button&2?3:a.button&4?2:0);return a},triggerEvent:function(a,c){var e=d.getData(a),f=c.type||c,g;e&&(g=e.handler);c="object"===typeof c?c[d.expando]?c:new d.Event(f,c):new d.Event(f);c.type=f;g&&g.call(a,c);c.result=b;c.target=a},one:function(a,b,c){d.addEvent(a,b,function(){d.removeEvent(a,b,arguments.callee);c.apply(this,arguments)})}});
d.Event=function(a,b){a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||!1===a.returnValue||a.getPreventDefault&&a.getPreventDefault()?c:e):this.type=a;b&&d.merge(this,b);this.timeStamp=(new Date).getTime();this[d.expando]=!0};d.Event.prototype={preventDefault:function(){this.isDefaultPrevented=c;var a=this.originalEvent;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=c;var a=this.originalEvent;
a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=c;this.stopPropagation()},isDefaultPrevented:e,isPropagationStopped:e,isImmediatePropagationStopped:e};d.Event.props="altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" ");
var s;s||(s={});(function(){var a=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!==typeof s.parse&&(s.parse=function(c,d){function e(a,c){var f,p,g=a[c];if(g&&"object"===typeof g)for(f in g)Object.prototype.hasOwnProperty.call(g,f)&&(p=e(g,f),p!==b?g[f]=p:delete g[f]);return d.call(a,c,g)}var f;c=String(c);a.lastIndex=0;a.test(c)&&(c=c.replace(a,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,
"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+c+")"),"function"===typeof d?e({"":f},""):f;throw new SyntaxError("JSON.parse");})})();d.Player=d.Component.extend({init:function(a,b,c){this.tag=a;var e=this.el=d.createElement("div"),f=this.options={},g=f.width=a.getAttribute("width"),h=f.height=a.getAttribute("height"),g=g||300,h=h||150;a.player=e.player=this;this.ready(c);a.parentNode.insertBefore(e,a);e.appendChild(a);
e.id=this.id=a.id;e.className=a.className;a.id+="_html5_api";a.className="vjs-tech";d.players[e.id]=this;e.setAttribute("width",g);e.setAttribute("height",h);e.style.width=g+"px";e.style.height=h+"px";a.removeAttribute("width");a.removeAttribute("height");d.merge(f,d.options);d.merge(f,this.getVideoTagSettings());d.merge(f,b);a.removeAttribute("controls");a.removeAttribute("poster");if(a.hasChildNodes()){b=0;for(c=a.childNodes;b<c.length;b++)("SOURCE"==c[b].nodeName||"TRACK"==c[b].nodeName)&&a.removeChild(c[b])}this.values=
{};this.addClass("vjs-paused");this.addEvent("ended",this.onEnded);this.addEvent("play",this.onPlay);this.addEvent("pause",this.onPause);this.addEvent("progress",this.onProgress);this.addEvent("error",this.onError);f.controls&&this.ready(function(){this.initComponents()});this.textTracks=[];f.tracks&&0<f.tracks.length&&this.addTextTracks(f.tracks);if(!f.sources||0==f.sources.length){b=0;for(c=f.techOrder;b<c.length;b++)if(a=c[b],d[a].isSupported()){this.loadTech(a);break}}else this.src(f.sources)},
values:{},destroy:function(){this.stopTrackingProgress();this.stopTrackingCurrentTime();d.players[this.id]=null;delete d.players[this.id];this.tech.destroy();null!==this.el.parentNode&&this.el.parentNode.removeChild(this.el)},createElement:function(){},getVideoTagSettings:function(){var a={sources:[],tracks:[]};a.src=this.tag.getAttribute("src");a.controls=null!==this.tag.getAttribute("controls");a.poster=this.tag.getAttribute("poster");a.preload=this.tag.getAttribute("preload");a.autoplay=null!==
this.tag.getAttribute("autoplay");a.loop=null!==this.tag.getAttribute("loop");a.muted=null!==this.tag.getAttribute("muted");if(this.tag.hasChildNodes())for(var b,c=0,d=this.tag.childNodes;c<d.length;c++)b=d[c],"SOURCE"==b.nodeName&&a.sources.push({src:b.getAttribute("src"),type:b.getAttribute("type"),media:b.getAttribute("media"),title:b.getAttribute("title")}),"TRACK"==b.nodeName&&a.tracks.push({src:b.getAttribute("src"),kind:b.getAttribute("kind"),srclang:b.getAttribute("srclang"),label:b.getAttribute("label"),
"default":null!==b.getAttribute("default"),title:b.getAttribute("title")});return a},loadTech:function(a,b){this.tech?this.unloadTech():"html5"!=a&&this.tag&&(this.el.removeChild(this.tag),this.tag=!1);this.techName=a;this.isReady=!1;var c=d.merge({source:b,parentEl:this.el},this.options[a]);b&&(b.src==this.values.src&&0<this.values.currentTime&&(c.startTime=this.values.currentTime),this.values.src=b.src);this.tech=new d[a](this,c);this.tech.ready(function(){this.player.triggerReady();this.support.progressEvent||
this.player.manualProgressOn();this.support.timeupdateEvent||this.player.manualTimeUpdatesOn()})},unloadTech:function(){this.tech.destroy();this.manualProgress&&this.manualProgressOff();this.manualTimeUpdates&&this.manualTimeUpdatesOff();this.tech=!1},manualProgressOn:function(){this.manualProgress=!0;this.trackProgress();this.tech.addEvent("progress",function(){this.removeEvent("progress",arguments.callee);this.support.progressEvent=!0;this.player.manualProgressOff()})},manualProgressOff:function(){this.manualProgress=
!1;this.stopTrackingProgress()},trackProgress:function(){this.progressInterval=setInterval(d.proxy(this,function(){this.values.bufferEnd<this.buffered().end(0)?this.triggerEvent("progress"):1==this.bufferedPercent()&&(this.stopTrackingProgress(),this.triggerEvent("progress"))}),500)},stopTrackingProgress:function(){clearInterval(this.progressInterval)},manualTimeUpdatesOn:function(){this.manualTimeUpdates=!0;this.addEvent("play",this.trackCurrentTime);this.addEvent("pause",this.stopTrackingCurrentTime);
this.tech.addEvent("timeupdate",function(){this.removeEvent("timeupdate",arguments.callee);this.support.timeupdateEvent=!0;this.player.manualTimeUpdatesOff()})},manualTimeUpdatesOff:function(){this.manualTimeUpdates=!1;this.stopTrackingCurrentTime();this.removeEvent("play",this.trackCurrentTime);this.removeEvent("pause",this.stopTrackingCurrentTime)},trackCurrentTime:function(){this.currentTimeInterval&&this.stopTrackingCurrentTime();this.currentTimeInterval=setInterval(d.proxy(this,function(){this.triggerEvent("timeupdate")}),
250)},stopTrackingCurrentTime:function(){clearInterval(this.currentTimeInterval)},onEnded:function(){this.options.loop?(this.currentTime(0),this.play()):this.pause()},onPlay:function(){d.removeClass(this.el,"vjs-paused");d.addClass(this.el,"vjs-playing")},onPause:function(){d.removeClass(this.el,"vjs-playing");d.addClass(this.el,"vjs-paused")},onProgress:function(){1==this.bufferedPercent()&&this.triggerEvent("loadedalldata")},onError:function(a){d.log("Video Error",a)},techCall:function(a,b){if(this.tech.isReady)try{this.tech[a](b)}catch(c){d.log(c)}else this.tech.ready(function(){this[a](b)})},
techGet:function(a){if(this.tech.isReady)try{return this.tech[a]()}catch(c){this.tech[a]===b?d.log("Video.js: "+a+" method not defined for "+this.techName+" playback technology.",c):"TypeError"==c.name?(d.log("Video.js: "+a+" unavailable on "+this.techName+" playback technology element.",c),this.tech.isReady=!1):d.log(c)}},play:function(){this.techCall("play");return this},pause:function(){this.techCall("pause");return this},paused:function(){return!1===this.techGet("paused")?!1:!0},currentTime:function(a){return a!==
b?(this.values.lastSetCurrentTime=a,this.techCall("setCurrentTime",a),this.manualTimeUpdates&&this.triggerEvent("timeupdate"),this):this.values.currentTime=this.techGet("currentTime")||0},duration:function(){return parseFloat(this.techGet("duration"))},remainingTime:function(){return this.duration()-this.currentTime()},buffered:function(){var a=this.techGet("buffered"),b=this.values.bufferEnd=this.values.bufferEnd||0;a&&(0<a.length&&a.end(0)!==b)&&(b=a.end(0),this.values.bufferEnd=b);return d.createTimeRange(0,
b)},bufferedPercent:function(){return this.duration()?this.buffered().end(0)/this.duration():0},volume:function(a){if(a!==b)return a=Math.max(0,Math.min(1,parseFloat(a))),this.values.volume=a,this.techCall("setVolume",a),d.setLocalStorage("volume",a),this;a=parseFloat(this.techGet("volume"));return isNaN(a)?1:a},muted:function(a){return a!==b?(this.techCall("setMuted",a),this):this.techGet("muted")||!1},width:function(a,c){return a!==b?(this.el.width=a,this.el.style.width=a+"px",c||this.triggerEvent("resize"),
this):parseInt(this.el.getAttribute("width"))},height:function(a){return a!==b?(this.el.height=a,this.el.style.height=a+"px",this.triggerEvent("resize"),this):parseInt(this.el.getAttribute("height"))},size:function(a,b){return this.width(a,!0).height(b)},supportsFullScreen:function(){return this.techGet("supportsFullScreen")||!1},requestFullScreen:function(){var a=d.support.requestFullScreen;this.isFullScreen=!0;a?(d.addEvent(f,a.eventName,this.proxy(function(){this.isFullScreen=f[a.isFullScreen];
!1==this.isFullScreen&&d.removeEvent(f,a.eventName,arguments.callee);this.triggerEvent("fullscreenchange")})),!1===this.tech.support.fullscreenResize&&!0!=this.options.flash.iFrameMode&&(this.pause(),this.unloadTech(),d.addEvent(f,a.eventName,this.proxy(function(){d.removeEvent(f,a.eventName,arguments.callee);this.loadTech(this.techName,{src:this.values.src})}))),this.el[a.requestFn]()):this.tech.supportsFullScreen()?(this.triggerEvent("fullscreenchange"),this.techCall("enterFullScreen")):(this.triggerEvent("fullscreenchange"),
this.enterFullWindow());return this},cancelFullScreen:function(){var a=d.support.requestFullScreen;this.isFullScreen=!1;a?(!1===this.tech.support.fullscreenResize&&!0!=this.options.flash.iFrameMode&&(this.pause(),this.unloadTech(),d.addEvent(f,a.eventName,this.proxy(function(){d.removeEvent(f,a.eventName,arguments.callee);this.loadTech(this.techName,{src:this.values.src})}))),f[a.cancelFn]()):(this.tech.supportsFullScreen()?this.techCall("exitFullScreen"):this.exitFullWindow(),this.triggerEvent("fullscreenchange"));
return this},enterFullWindow:function(){this.isFullWindow=!0;this.docOrigOverflow=f.documentElement.style.overflow;d.addEvent(f,"keydown",d.proxy(this,this.fullWindowOnEscKey));f.documentElement.style.overflow="hidden";d.addClass(f.body,"vjs-full-window");d.addClass(this.el,"vjs-fullscreen");this.triggerEvent("enterFullWindow")},fullWindowOnEscKey:function(a){27==a.keyCode&&(!0==this.isFullScreen?this.cancelFullScreen():this.exitFullWindow())},exitFullWindow:function(){this.isFullWindow=!1;d.removeEvent(f,
"keydown",this.fullWindowOnEscKey);f.documentElement.style.overflow=this.docOrigOverflow;d.removeClass(f.body,"vjs-full-window");d.removeClass(this.el,"vjs-fullscreen");this.triggerEvent("exitFullWindow")},selectSource:function(a){for(var b=0,c=this.options.techOrder;b<c.length;b++){var e=c[b],f=d[e];if(f.isSupported())for(var g=0,h=a;g<h.length;g++){var l=h[g];if(f.canPlaySource.call(this,l))return{source:l,tech:e}}}return!1},src:function(a){if(a instanceof Array){var b=this.selectSource(a);b?(a=
b.source,b=b.tech,b==this.techName?this.src(a):this.loadTech(b,a)):d.log("No compatible source and playback technology were found.")}else a instanceof Object?d[this.techName].canPlaySource(a)?this.src(a.src):this.src([a]):(this.values.src=a,this.isReady?(this.techCall("src",a),"auto"==this.options.preload&&this.load(),this.options.autoplay&&this.play()):this.ready(function(){this.src(a)}));return this},load:function(){this.techCall("load");return this},currentSrc:function(){return this.techGet("currentSrc")||
this.values.src||""},preload:function(a){return a!==b?(this.techCall("setPreload",a),this.options.preload=a,this):this.techGet("preload")},autoplay:function(a){return a!==b?(this.techCall("setAutoplay",a),this.options.autoplay=a,this):this.techGet("autoplay",a)},loop:function(a){return a!==b?(this.techCall("setLoop",a),this.options.loop=a,this):this.techGet("loop")},controls:function(){return this.options.controls},poster:function(){return this.techGet("poster")},error:function(){return this.techGet("error")},
ended:function(){return this.techGet("ended")}});var q,t,u,v;f.cancelFullscreen!==b?(q="requestFullscreen",t="exitFullscreen",u="fullscreenchange",v="fullScreen"):d.each(["moz","webkit"],function(a){if(("moz"!=a||f.mozFullScreenEnabled)&&f[a+"CancelFullScreen"]!==b)q=a+"RequestFullScreen",t=a+"CancelFullScreen",u=a+"fullscreenchange",v="webkit"==a?a+"IsFullScreen":a+"FullScreen"});q&&(d.support.requestFullScreen={requestFn:q,cancelFn:t,eventName:u,isFullScreen:v});d.PlaybackTech=d.Component.extend({init:function(){},
onClick:function(){this.player.options.controls&&d.PlayToggle.prototype.onClick.call(this)}});d.apiMethods="play pause paused currentTime setCurrentTime duration buffered volume setVolume muted setMuted width height supportsFullScreen enterFullScreen src load currentSrc preload setPreload autoplay setAutoplay loop setLoop error networkState readyState seeking initialTime startOffsetTime played seekable ended videoTracks audioTracks videoWidth videoHeight textTracks defaultPlaybackRate playbackRate mediaGroup controller controls defaultMuted".split(" ");
d.each(d.apiMethods,function(a){d.PlaybackTech.prototype[a]=function(){throw Error("The '"+a+"' method is not available on the playback technology's API");}});d.html5=d.PlaybackTech.extend({init:function(a,b,c){this.player=a;this.el=this.createElement();this.ready(c);this.addEvent("click",this.proxy(this.onClick));(b=b.source)&&this.el.currentSrc==b.src?a.triggerEvent("loadstart"):b&&(this.el.src=b.src);a.ready(function(){this.options.autoplay&&this.paused()&&(this.tag.poster=null,this.play())});
this.setupTriggers();this.triggerReady()},destroy:function(){this.player.tag=!1;this.removeTriggers();null!==this.el.parentNode&&this.el.parentNode.removeChild(this.el)},createElement:function(){var a=this.player,b=a.tag,c;if(!b||!1===this.support.movingElementInDOM)b&&a.el.removeChild(b),b=c=d.createElement("video",{id:b.id||a.el.id+"_html5_api",className:b.className||"vjs-tech"}),d.insertFirst(b,a.el);d.each(["autoplay","preload","loop","muted"],function(c){null!==a.options[c]&&(b[c]=a.options[c])},
this);return b},setupTriggers:function(){d.each.call(this,d.html5.events,function(a){d.addEvent(this.el,a,d.proxy(this.player,this.eventHandler))})},removeTriggers:function(){d.each.call(this,d.html5.events,function(a){d.removeEvent(this.el,a,d.proxy(this.player,this.eventHandler))})},eventHandler:function(a){a.stopPropagation();this.triggerEvent(a)},play:function(){this.el.play()},pause:function(){this.el.pause()},paused:function(){return this.el.paused},currentTime:function(){return this.el.currentTime},
setCurrentTime:function(a){try{this.el.currentTime=a}catch(b){d.log(b,"Video isn't ready. (VideoJS)")}},duration:function(){return this.el.duration||0},buffered:function(){return this.el.buffered},volume:function(){return this.el.volume},setVolume:function(a){this.el.volume=a},muted:function(){return this.el.muted},setMuted:function(a){this.el.muted=a},width:function(){return this.el.offsetWidth},height:function(){return this.el.offsetHeight},supportsFullScreen:function(){return"function"==typeof this.el.webkitEnterFullScreen&&
!navigator.userAgent.match("Chrome")&&!navigator.userAgent.match("Mac OS X 10.5")?!0:!1},enterFullScreen:function(){try{this.el.webkitEnterFullScreen()}catch(a){11==a.code&&d.log("VideoJS: Video not ready.")}},src:function(a){this.el.src=a},load:function(){this.el.load()},currentSrc:function(){return this.el.currentSrc},preload:function(){return this.el.preload},setPreload:function(a){this.el.preload=a},autoplay:function(){return this.el.autoplay},setAutoplay:function(a){this.el.autoplay=a},loop:function(){return this.el.loop},
setLoop:function(a){this.el.loop=a},error:function(){return this.el.error},seeking:function(){return this.el.seeking},ended:function(){return this.el.ended},controls:function(){return this.player.options.controls},defaultMuted:function(){return this.el.defaultMuted}});d.html5.isSupported=function(){return!!f.createElement("video").canPlayType};d.html5.canPlaySource=function(a){return!!f.createElement("video").canPlayType(a.type)};d.html5.events="loadstart suspend abort error emptied stalled loadedmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate progress play pause ratechange volumechange".split(" ");
d.html5.prototype.support={fullscreen:typeof d.testVid.webkitEnterFullScreen!==b?!d.ua.match("Chrome")&&!d.ua.match("Mac OS X 10.5")?!0:!1:!1,movingElementInDOM:!d.isIOS()};d.isAndroid()&&3>d.androidVersion()&&(f.createElement("video").constructor.prototype.canPlayType=function(a){return a&&-1!=a.toLowerCase().indexOf("video/mp4")?"maybe":""});d.flash=d.PlaybackTech.extend({init:function(a,b){this.player=a;var c=b.source,e=b.parentEl,f=this.el=d.createElement("div",{id:e.id+"_temp_flash"}),g=a.el.id+
"_flash_api",h=a.options,l=d.merge({readyFunction:"_V_.flash.onReady",eventProxyFunction:"_V_.flash.onEvent",errorEventProxyFunction:"_V_.flash.onError",autoplay:h.autoplay,preload:h.preload,loop:h.loop,muted:h.muted},b.flashVars),k=d.merge({wmode:"opaque",bgcolor:"#000000"},b.params),m=d.merge({id:g,name:g,"class":"vjs-tech"},b.attributes);c&&(l.src=encodeURIComponent(d.getAbsoluteURL(c.src)));d.insertFirst(f,e);b.startTime&&this.ready(function(){this.load();this.play();this.currentTime(b.startTime)});
if(!0==b.iFrameMode&&!d.isFF){var j=d.createElement("iframe",{id:g+"_iframe",name:g+"_iframe",className:"vjs-tech",scrolling:"no",marginWidth:0,marginHeight:0,frameBorder:0});l.readyFunction="ready";l.eventProxyFunction="events";l.errorEventProxyFunction="errors";d.addEvent(j,"load",d.proxy(this,function(){var a,c=j.contentWindow;a=j.contentDocument?j.contentDocument:j.contentWindow.document;a.write(d.flash.getEmbedCode(b.swf,l,k,m));c.player=this.player;c.ready=d.proxy(this.player,function(b){b=
a.getElementById(b);var c=this.tech;c.el=b;d.addEvent(b,"click",c.proxy(c.onClick));d.flash.checkReady(c)});c.events=d.proxy(this.player,function(a,b){this&&"flash"==this.techName&&this.triggerEvent(b)});c.errors=d.proxy(this.player,function(a,b){d.log("Flash Error",b)})}));f.parentNode.replaceChild(j,f)}else d.flash.embed(b.swf,f,l,k,m)},destroy:function(){null!==this.el.parentNode&&this.el.parentNode.removeChild(this.el)},play:function(){this.el.vjs_play()},pause:function(){this.el.vjs_pause()},
src:function(a){a=d.getAbsoluteURL(a);this.el.vjs_src(a);if(this.player.autoplay()){var b=this;setTimeout(function(){b.play()},0)}},load:function(){this.el.vjs_load()},poster:function(){this.el.vjs_getProperty("poster")},buffered:function(){return d.createTimeRange(0,this.el.vjs_getProperty("buffered"))},supportsFullScreen:function(){return!1},enterFullScreen:function(){return!1}});var y=d.flash.prototype;createSetter=function(a){var b=a.charAt(0).toUpperCase()+a.slice(1);y["set"+b]=function(b){return this.el.vjs_setProperty(a,
b)}};createGetter=function(a){y[a]=function(){return this.el.vjs_getProperty(a)}};d.each("preload currentTime defaultPlaybackRate playbackRate autoplay loop mediaGroup controller controls volume muted defaultMuted".split(" "),function(a){createGetter(a);createSetter(a)});d.each("error currentSrc networkState readyState seeking initialTime duration startOffsetTime paused played seekable ended videoTracks audioTracks videoWidth videoHeight textTracks".split(" "),function(a){createGetter(a)});d.flash.isSupported=
function(){return 10<=d.flash.version()[0]};d.flash.canPlaySource=function(a){if(a.type in d.flash.prototype.support.formats)return"maybe"};d.flash.prototype.support={formats:{"video/flv":"FLV","video/x-flv":"FLV","video/mp4":"MP4","video/m4v":"MP4"},progressEvent:!1,timeupdateEvent:!1,fullscreenResize:!1,parentResize:!d.ua.match("Firefox")};d.flash.onReady=function(a){a=d.el(a);var b=a.player||a.parentNode.player,c=b.tech;a.player=b;c.el=a;c.addEvent("click",c.onClick);d.flash.checkReady(c)};d.flash.checkReady=
function(a){a.el.vjs_getProperty?a.triggerReady():setTimeout(function(){d.flash.checkReady(a)},50)};d.flash.onEvent=function(a,b){d.el(a).player.triggerEvent(b)};d.flash.onError=function(a,b){d.el(a).player.triggerEvent("error");d.log("Flash Error",b,a)};d.flash.version=function(){var a="0,0,0";try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(b){try{navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&
(a=(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1])}catch(c){}}return a.split(",")};d.flash.embed=function(a,b,c,e,f){a=d.flash.getEmbedCode(a,c,e,f);a=d.createElement("div",{innerHTML:a}).childNodes[0];c=b.parentNode;b.parentNode.replaceChild(a,b);if(d.isIE()){var g=c.childNodes[0];setTimeout(function(){g.style.display="block"},1E3)}return a};d.flash.getEmbedCode=function(a,b,c,e){var f="",g="";attrsString="";
b&&d.eachProp(b,function(a,b){f+=a+"="+b+"&amp;"});c=d.merge({movie:a,flashvars:f,allowScriptAccess:"always",allowNetworking:"all"},c);d.eachProp(c,function(a,b){g+='<param name="'+a+'" value="'+b+'" />'});e=d.merge({data:a,width:"100%",height:"100%"},e);d.eachProp(e,function(a,b){attrsString+=a+'="'+b+'" '});return'<object type="application/x-shockwave-flash"'+attrsString+">"+g+"</object>"};d.merge(d.Player.prototype,{addTextTracks:function(a){for(var b=this.textTracks=this.textTracks?this.textTracks:
[],c=0,e=a.length,f;c<e;c++)f=d.uc(a[c].kind||"subtitles"),f=new d[f+"Track"](this,a[c]),b.push(f),f["default"]&&this.ready(d.proxy(f,f.show));return this},showTextTrack:function(a,b){for(var c=this.textTracks,d=0,e=c.length,f,g;d<e;d++)f=c[d],f.id===a?(f.show(),g=f):b&&(f.kind==b&&0<f.mode)&&f.disable();(c=g?g.kind:b?b:!1)&&this.triggerEvent(c+"trackchange");return this}});d.Track=d.Component.extend({init:function(a,b){this._super(a,b);d.merge(this,{id:b.id||"vjs_"+b.kind+"_"+b.language+"_"+d.guid++,
src:b.src,"default":b["default"],title:b.title,language:b.srclang,label:b.label,cues:[],activeCues:[],readyState:0,mode:0})},createElement:function(){return this._super("div",{className:"vjs-"+this.kind+" vjs-text-track"})},show:function(){this.activate();this.mode=2;this._super()},hide:function(){this.activate();this.mode=1;this._super()},disable:function(){2==this.mode&&this.hide();this.deactivate();this.mode=0},activate:function(){0==this.readyState&&this.load();0==this.mode&&(this.player.addEvent("timeupdate",
this.proxy(this.update,this.id)),this.player.addEvent("ended",this.proxy(this.reset,this.id)),("captions"==this.kind||"subtitles"==this.kind)&&this.player.textTrackDisplay.addComponent(this))},deactivate:function(){this.player.removeEvent("timeupdate",this.proxy(this.update,this.id));this.player.removeEvent("ended",this.proxy(this.reset,this.id));this.reset();this.player.textTrackDisplay.removeComponent(this)},load:function(){0==this.readyState&&(this.readyState=1,d.get(this.src,this.proxy(this.parseCues),
this.proxy(this.onError)))},onError:function(a){this.error=a;this.readyState=3;this.triggerEvent("error")},parseCues:function(a){var b,c;a=a.split("\n");for(var e="",f=1,g=a.length;f<g;f++)if(e=d.trim(a[f])){-1==e.indexOf("--\x3e")?(b=e,e=d.trim(a[++f])):b=this.cues.length;b={id:b,index:this.cues.length};c=e.split(" --\x3e ");b.startTime=this.parseCueTime(c[0]);b.endTime=this.parseCueTime(c[1]);for(c=[];a[++f]&&(e=d.trim(a[f]));)c.push(e);b.text=c.join("<br/>");this.cues.push(b)}this.readyState=2;
this.triggerEvent("loaded")},parseCueTime:function(a){var b=a.split(":");a=0;var c,d,e;3==b.length?(c=b[0],d=b[1],b=b[2]):(c=0,d=b[0],b=b[1]);b=b.split(/\s+/);b=b.splice(0,1)[0];b=b.split(/\.|,/);e=parseFloat(b[1]);b=b[0];a+=3600*parseFloat(c);a+=60*parseFloat(d);a+=parseFloat(b);e&&(a+=e/1E3);return a},update:function(){if(0<this.cues.length){var a=this.player.currentTime();if(this.prevChange===b||a<this.prevChange||this.nextChange<=a){var c=this.cues,d=this.player.duration(),e=0,f=!1,g=[],h,l,k,
j;a>=this.nextChange||this.nextChange===b?j=this.firstActiveIndex!==b?this.firstActiveIndex:0:(f=!0,j=this.lastActiveIndex!==b?this.lastActiveIndex:c.length-1);for(;;){k=c[j];if(k.endTime<=a)e=Math.max(e,k.endTime),k.active&&(k.active=!1);else if(a<k.startTime){if(d=Math.min(d,k.startTime),k.active&&(k.active=!1),!f)break}else f?(g.splice(0,0,k),l===b&&(l=j),h=j):(g.push(k),h===b&&(h=j),l=j),d=Math.min(d,k.endTime),e=Math.max(e,k.startTime),k.active=!0;if(f)if(0===j)break;else j--;else if(j===c.length-
1)break;else j++}this.activeCues=g;this.nextChange=d;this.prevChange=e;this.firstActiveIndex=h;this.lastActiveIndex=l;this.updateDisplay();this.triggerEvent("cuechange")}}},updateDisplay:function(){for(var a=this.activeCues,b="",c=0,d=a.length;c<d;c++)b+="<span class='vjs-tt-cue'>"+a[c].text+"</span>";this.el.innerHTML=b},reset:function(){this.nextChange=0;this.prevChange=this.player.duration();this.lastActiveIndex=this.firstActiveIndex=0}});d.CaptionsTrack=d.Track.extend({kind:"captions"});d.SubtitlesTrack=
d.Track.extend({kind:"subtitles"});d.ChaptersTrack=d.Track.extend({kind:"chapters"});d.TextTrackDisplay=d.Component.extend({createElement:function(){return this._super("div",{className:"vjs-text-track-display"})}});d.TextTrackMenuItem=d.MenuItem.extend({init:function(a,b){var c=this.track=b.track;b.label=c.label;b.selected=c["default"];this._super(a,b);this.player.addEvent(c.kind+"trackchange",d.proxy(this,this.update))},onClick:function(){this._super();this.player.showTextTrack(this.track.id,this.track.kind)},
update:function(){2==this.track.mode?this.selected(!0):this.selected(!1)}});d.OffTextTrackMenuItem=d.TextTrackMenuItem.extend({init:function(a,b){b.track={kind:b.kind,player:a,label:"Off"};this._super(a,b)},onClick:function(){this._super();this.player.showTextTrack(this.track.id,this.track.kind)},update:function(){for(var a=this.player.textTracks,b=0,c=a.length,d,e=!0;b<c;b++)d=a[b],d.kind==this.track.kind&&2==d.mode&&(e=!1);e?this.selected(!0):this.selected(!1)}});d.TextTrackButton=d.Button.extend({init:function(a,
b){this._super(a,b);this.menu=this.createMenu();0===this.items.length&&this.hide()},createMenu:function(){var a=new d.Menu(this.player);a.el.appendChild(d.createElement("li",{className:"vjs-menu-title",innerHTML:d.uc(this.kind)}));a.addItem(new d.OffTextTrackMenuItem(this.player,{kind:this.kind}));this.items=this.createItems();this.each(this.items,function(b){a.addItem(b)});this.addComponent(a);return a},createItems:function(){var a=[];this.each(this.player.textTracks,function(b){b.kind===this.kind&&
a.push(new d.TextTrackMenuItem(this.player,{track:b}))});return a},buildCSSClass:function(){return this.className+" vjs-menu-button "+this._super()},onFocus:function(){this.menu.lockShowing();d.one(this.menu.el.childNodes[this.menu.el.childNodes.length-1],"blur",this.proxy(function(){this.menu.unlockShowing()}))},onBlur:function(){},onClick:function(){this.one("mouseout",this.proxy(function(){this.menu.unlockShowing();this.el.blur()}))}});d.CaptionsButton=d.TextTrackButton.extend({kind:"captions",
buttonText:"Captions",className:"vjs-captions-button"});d.SubtitlesButton=d.TextTrackButton.extend({kind:"subtitles",buttonText:"Subtitles",className:"vjs-subtitles-button"});d.ChaptersButton=d.TextTrackButton.extend({kind:"chapters",buttonText:"Chapters",className:"vjs-chapters-button",createItems:function(){var a=[];this.each(this.player.textTracks,function(b){b.kind===this.kind&&a.push(new d.TextTrackMenuItem(this.player,{track:b}))});return a},createMenu:function(){for(var a=this.player.textTracks,
b=0,c=a.length,e,f,g=this.items=[];b<c;b++)if(e=a[b],e.kind==this.kind&&e["default"]){if(2>e.readyState){this.chaptersTrack=e;e.addEvent("loaded",this.proxy(this.createMenu));return}f=e;break}a=this.menu=new d.Menu(this.player);a.el.appendChild(d.createElement("li",{className:"vjs-menu-title",innerHTML:d.uc(this.kind)}));if(f){e=f.cues;for(var b=0,c=e.length,h;b<c;b++)h=e[b],h=new d.ChaptersTrackMenuItem(this.player,{track:f,cue:h}),g.push(h),a.addComponent(h)}this.addComponent(a);0<this.items.length&&
this.show();return a}});d.ChaptersTrackMenuItem=d.MenuItem.extend({init:function(a,b){var c=this.track=b.track,e=this.cue=b.cue,f=a.currentTime();b.label=e.text;b.selected=e.startTime<=f&&f<e.endTime;this._super(a,b);c.addEvent("cuechange",d.proxy(this,this.update))},onClick:function(){this._super();this.player.currentTime(this.cue.startTime);this.update(this.cue.startTime)},update:function(){var a=this.cue,b=this.player.currentTime();a.startTime<=b&&b<a.endTime?this.selected(!0):this.selected(!1)}});
d.merge(d.ControlBar.prototype.options.components,{subtitlesButton:{},captionsButton:{},chaptersButton:{}});d.autoSetup=function(){var a,c,e=f.getElementsByTagName("video");if(e&&0<e.length)for(var g=0,h=e.length;g<h;g++)if((c=e[g])&&c.getAttribute)c.player===b&&(a=c.getAttribute("data-setup"),null!==a&&(a=s.parse(a||"{}"),d(c,a)));else{d.autoSetupTimeout(1);break}else d.windowLoaded||d.autoSetupTimeout(1)};d.autoSetupTimeout=function(a){setTimeout(d.autoSetup,a)};d.addEvent(a,"load",function(){d.windowLoaded=
!0});d.autoSetup();a.VideoJS=a._V_=g})(window);Function.prototype.bind&&(("object"===typeof console||"function"===typeof console)&&"object"==typeof console.log)&&"log info warn error assert dir clear profile profileEnd".split(" ").forEach(function(a){console[a]=this.call(console[a],console)},Function.prototype.bind);
window.log=function(){log.history=log.history||[];log.history.push(arguments);if("undefined"!=typeof console&&"function"==typeof console.log)if(window.opera)for(var a=0;a<arguments.length;)console.log("Item "+(a+1)+": "+arguments[a]),a++;else 1==Array.prototype.slice.call(arguments).length&&"string"==typeof Array.prototype.slice.call(arguments)[0]?console.log(Array.prototype.slice.call(arguments).toString()):console.log(Array.prototype.slice.call(arguments));else!Function.prototype.bind&&"undefined"!=
typeof console&&"object"==typeof console.log?Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments)):document.getElementById("firebug-lite")?setTimeout(function(){log(Array.prototype.slice.call(arguments))},500):(a=document.createElement("script"),a.type="text/javascript",a.id="firebug-lite",a.src="https://getfirebug.com/firebug-lite.js",document.getElementsByTagName("HEAD")[0].appendChild(a),setTimeout(function(){log(Array.prototype.slice.call(arguments))},2E3))};function moduleProgressSetup(a){var b=userTracker.getModuleProgress(a),c=new Element("div",{id:"Module_progress_"+a,html:"Progress: ","class":"module_progress_title"});new dwProgressBar({container:c,startPercentage:b.progress,speed:1E3,boxID:"module_progress_box_"+a,boxClass:"module_progress_box",percentageID:"module_progress_perc_"+a,percentageClass:"module_progress_perc",displayText:!0,displayID:"text_"+a,displayClass:"module_progress_title",styles:{width:"300px",height:"5px"}});return c};function getPos(a){for(var b=0,c=0;null!=a;b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent);return{x:b,y:c}}function stripFileExtension(a){void 0!=a&&null!=a&&(a=a.replace(/(.*)\.[^.]+$/,"$1"));return a}function lzw_encode(a){var b={};a=(a+"").split("");for(var c=[],e,f=a[0],g=256,d=1;d<a.length;d++)e=a[d],null!=b[f+e]?f+=e:(c.push(1<f.length?b[f]:f.charCodeAt(0)),b[f+e]=g,g++,f=e);c.push(1<f.length?b[f]:f.charCodeAt(0));for(d=0;d<c.length;d++)c[d]=String.fromCharCode(c[d]);return c.join("")}
function lzw_decode(a){var b={};a=(a+"").split("");for(var c=a[0],e=c,f=[c],g=256,d,h=1;h<a.length;h++)d=a[h].charCodeAt(0),d=256>d?a[h]:b[d]?b[d]:e+c,f.push(d),c=d.charAt(0),b[g]=e+c,g++,e=d;return f.join("")}function isFlashSupported(){return 9<=Browser.Plugins.Flash.version?!0:!1}function isEven(a){a=Number(a);return 0===a||!(!a||a%2)}
function my_getDroppableCoordinates(a){var b=a.getBBox(),c={};c.left=b.x;c.top=b.y;c.bottom=b.y+b.height;c.right=b.x+b.width;"fixed"==a.getStyle("position")&&(a=window.getScroll(),c.left+=a.x,c.right+=a.x,c.top+=a.y,c.bottom+=a.y);return c};Array.CASEINSENSITIVE=1;Array.DESCENDING=2;Array.UNIQUESORT=4;Array.RETURNINDEXEDARRAY=8;Array.NUMERIC=16;
(function(){var a=function(a,c){var e=c&Array.NUMERIC?this.map(function(c){return c[a].toFloat()}):c&Array.CASEINSENSITIVE?this.map(function(c){return c[a].toLowerCase()}):this.map(function(c){return c[a]});return e.length!==[].combine(e).length};Array.implement({sortOn:function(b,c){b=Array.from(b);c=Array.from(c);c.length!==b.length&&(c=[]);if(c[0]&Array.UNIQUESORT&&b.some(function(b,e){return a(b,c[e])}))return 0;var e=function(a,e){return function h(b,c){var j,n,l,r=c[0];(function q(a,b,c){var e=
a[0];1<a.length?q(a.slice(1),b[e],c[e]):(n=b[e].toString(),l=c[e].toString())})(b[0].match(/[^.]+/g),a,e);r&Array.NUMERIC?j=n.toFloat()-l.toFloat():(r&Array.CASEINSENSITIVE&&(n=n.toLowerCase(),l=l.toLowerCase()),j=n>l?1:n<l?-1:0);0===j&&1<b.length?j=h(b.slice(1),c.slice(1)):r&Array.DESCENDING&&(j*=-1);return j}(b,c)};if(c[0]&Array.RETURNINDEXEDARRAY)return this.slice().sort(e);this.sort(e)}})})();var MediaLoader=new Class({Implements:[Options,Events],options:{parent:null,next:"data.loaded",progress:!1,parentElementID:driveSmartDivID},myParent:function(){return this.options.parent},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.loadQueue=new Hash({});this.progressBar=null;this.videoQueue=[]},register:function(a){if(!this.loadQueue.has(a.id)){var b="";Object.each(a,function(a){b=a.type});"VIDEO"==b||"FLASH"==b?this.videoQueue.push(a):this.loadQueue.extend(a)}},reportProgress:function(a){null!=
this.options.next&&(Object.each(a,function(a,c){this.loadQueue.has(c)&&this.loadQueue[c].progress<a.progress&&this.loadQueue.set(c,a)}.bind(this)),a=this._calculateProgress(),this._updateProgressBar(a),this._handleFinished(a))},_addProgressBar:function(){this.progressBar=new dwProgressBar({container:$(this.options.parentElementID),startPercentage:0,speed:10,boxID:"media_loader_box",boxClass:"media_loader_box",percentageID:"media_loader_perc",percentageClass:"media_loader_perc",displayID:"media_loader_disp",
displayText:!0,style:{left:"220px",top:"240px",position:"absolute","z-index":"99999"}})},_show:function(){this.progressBar.show()},hide:function(){this.progressBar.hide()},remove:function(){null!=this.progressBar&&(this.progressBar.remove(),this.progressBar=null)},start:function(a){!0==a&&(this._addProgressBar(),this._show());this._addOneVideoToQueue();this.loadQueue.each(function(a){a.ref.preload()})},_calculateProgress:function(){var a=0,b=0;this.loadQueue.each(function(c){void 0==c.progress&&(c.progress=
0);a+=c.progress*c.weight;b+=c.weight}.bind(this));return 100*(a/b)}.protect(),_updateProgressBar:function(a){null!=this.progressBar&&this.progressBar.set(a)}.protect(),_handleFinished:function(a){99<a&&(this.loadQueue.empty(),this.remove(),this.myParent().fireEvent("TIMELINE",{type:"preload.finished",id:this.options.id,next:this.options.next}),this.options.next="next.video.preloaded",this.start(!1))},_addOneVideoToQueue:function(){if(0<this.videoQueue.length){var a=this.videoQueue.shift();this.loadQueue.extend(a)}}});var DataLoader=new Class({Implements:[Options,Events],options:{src:"",id:"data.loader",next:"data.ready",parent:null},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.sequences=this.data=null},myParent:function(){return this.options.parent},start:function(){(new XML2Object).convertFromURL(this.options.src,function(a){this.data=a;this._setupSequences()}.bind(this))},getSteps:function(a){return Array.clone(this.sequences.get(a))},getSequenceIDs:function(){return null!=this.sequences?
this.sequences.getKeys():[]},_setupSequences:function(){var a=this.data.childNodes;this.sequences=new Hash({});Array.each(a,function(a){var c={};c[a.attributes.Ex]=a.childNodes;c[a.attributes.Ex].trackProgress=a.attributes.trackProgress;c[a.attributes.Ex].trackScore=a.attributes.trackScore;console.log("Seq",c);this.sequences.extend(c)}.bind(this));this.myParent().fireEvent("DATA",{type:"data.ready",id:this.options.id,next:this.options.next,data:this.sequences})}});var dwProgressBar=new Class({Implements:[Options],options:{container:$$("body")[0],boxID:"",boxClass:"box",percentageID:"",percentageClass:"perc",displayID:"",displayClass:"",startPercentage:0,displayText:!1,speed:10,styles:{width:"200px",height:"20px"}},initialize:function(a){this.setOptions(a);this.text=this.perc=this.box=null;this.createElements()},createElements:function(){this.container=new Element("div",{id:"progressBarHolder"});this.container.setStyles(this.options.style);this.box=new Element("div",
{id:this.options.boxID,"class":this.options.boxClass,styles:this.options.styles});this.perc=new Element("div",{id:this.options.percentageID,style:"width:0px;","class":this.options.percentageClass});this.perc.inject(this.box);this.box.inject(this.container);this.options.displayText&&(this.text=new Element("div",{id:this.options.displayID,"class":this.options.displayClass}),this.text.inject(this.container));this.container.inject(this.options.container);this.set(this.options.startPercentage)},calculate:function(a){return(this.box.getStyle("width").replace("px",
"")*(a/100)).toInt()},animate:function(a){(new Fx.Morph(this.perc,{duration:this.options.speed,transition:Fx.Transitions.Sine.easeOut})).start({width:[0,this.calculate(a.toInt())]});this.options.displayText&&this.text.set("text",a.toInt()+"%")},set:function(a){this.animate(a)},hide:function(){this.container.hide()},remove:function(){this.container.dispose()},show:function(){this.container.show()}});var ImagePlayer=new Class({Implements:[Options,Events],options:{style:{position:"absolute",top:"0px",left:"0px",opacity:"0",visibility:"hidden"},"class":"",src:"",id:"element.id",next:"next.action",loaded:!1,parent:null,parentTag:driveSmartDivID},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.containerID="imageContainer";this.container=null},myParent:function(){return this.options.parent},tween:function(a,b,c,e,f,g,d){c||(c=1);e||(e="opacity");f||(f=250);g||(g="chain");f=new Fx.Tween(this.image,
{duration:f,link:g});for(x=1;x<=c;x++)f.start(e,b,a).start(e,a,b);f.addEvent("complete",function(){this.myParent().fireEvent("TIMELINE",{type:"tween.done",id:this.options.id,next:d})}.bind(this))},obscure:function(){this.image.set("class","blur")},add:function(a,b){this.container=document.getElementById(a).getElement("div[id="+this.containerID+"]");null==this.container&&(this.container=new Element("div",{id:this.containerID}),this.container.inject($(a),b));this.image.inject(this.container);this.image.setStyles(this.options.style);
this._addEvents()},show:function(){this.image.fade("in")},display:function(){this.image.fade("show")},hide:function(){!0==this.image.isVisible()&&this.image.fade("out")},remove:function(){this.hide();this.image.destroy();this.container.destroy()},getLoaderInfo:function(){var a={},b=0;!0==this.options.loaded&&(b=1);a[this.options.id]={progress:b,weight:1,ref:this,type:"IMAGE"};return a},preload:function(){this.image=new Asset.image(this.options.src,{style:this.options.style,id:this.options.id,"class":this.options["class"],
onLoad:function(){this.options.loaded=!0;null!=this.myParent().mediaLoader&&void 0!=this.myParent().mediaLoader&&this.myParent().mediaLoader.reportProgress(this.getLoaderInfo());this.myParent().fireEvent("TIMELINE",{type:"image.ready",id:this.options.id,next:this.options.next})}.bind(this)})},_addEvents:function(){}});var VideoPlayer=new Class({Implements:[Options,Events],options:{style:{width:"640",height:"480",position:"absolute",left:"0px",top:"0px",opacity:"0",visibility:"hidden"},width:"640px",height:"480px","class":"video-js",poster:"",id:"element.id",next:"next.action",parent:null,preload:"auto",autoplay:!1,controls:!1,parentTag:driveSmartDivID,filename:null},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.source=[];this.containerID="container_"+this.options.id;this.playerID="player_"+
this.options.id;this.container=null;this.container=new Element("div",{id:this.containerID,"class":"videoContainer"});this.container.setStyles(this.options.style);this.container.inject($(this.options.parentTag));this.container.player=new Element("video",{id:this.playerID,preload:"auto",poster:"","class":this.options["class"],width:this.options.width,height:this.options.height});this.container.player.inject(this.container);this.player=_V_("player_"+this.options.id,{controls:this.options.controls,autoplay:this.options.autoplay,
preload:this.options.preload})},myParent:function(){return this.options.parent},preload:function(){void 0==this.player?(log("Undefined player ERRROR"),log(this),this.remove()):this.player.ready(function(){log("Player ready");var a=this._getVideoData();this.container.player.setProperty("poster",a.poster.src);this.player.src(a.video);this.player.size(this.options.style.width,this.options.style.height);this.player.pause();this.player.addEvent("loadstart",function(){this._reportProgress()}.bind(this));
this.player.addEvent("loadedmetadata",function(){this._reportProgress()}.bind(this));this.player.addEvent("loadeddata",function(){this._reportProgress()}.bind(this));this.player.addEvent("play",function(){this._reportProgress()}.bind(this));this.player.addEvent("ended",function(){this._reportProgress()}.bind(this));this.player.addEvent("progress",function(){this._reportProgress()}.bind(this));this.player.addEvent("loadedalldata",function(){this._reportProgress()}.bind(this));this.player.addEvent("timeupdate",
function(){this._reportProgress()}.bind(this));this.player.addEvent("suspend",function(){this._reportProgress()}.bind(this));this.player.addEvent("waiting",function(){this._reportProgress()}.bind(this));this.player.addEvent("canplay",function(){this._reportProgress()}.bind(this));this.player.addEvent("canplaythrough",function(){this._reportProgress(!0)}.bind(this));this.player.addEvent("ended",function(){this.myParent().fireEvent("TIMELINE",{type:"video.finished",id:this.options.id,next:this.options.next})}.bind(this))}.bind(this))},
start:function(){null!=this.player&&this.player.play()},show:function(){this.container.fade("show")},hide:function(){this.container.fade("hide")},obscure:function(){log("Obscure");log(this.container);Browser.ie?(new Mask(this.container,{style:{background:"rgba(00,00,00,0.98)"}})).show():this.container.set("class","blur")},stop:function(){null!=this.player&&(this.player.pause(),this.player.currentTime(0),this.player.pause())},skip:function(){null!=this.player&&(this.seek(this.player.duration()),this.myParent().fireEvent("TIMELINE",
{type:"video.finished",id:this.options.id,next:this.options.next}))},pause:function(){null!=this.player&&this.player.pause()},seek:function(a){this.player.pause();this.player.currentTime=a;this.player.pause()},volume:function(a){null!=this.player&&this.player.volume(a)},remove:function(){log("Removing player: "+this.playerID);var a=_V_(this.playerID);"html5"==a.techName&&(a.tag.src="",a.tech.removeTriggers(),a.load());a.tech.destroy();a.destroy();null!=this.container&&void 0!=this.container&&(this.container.player.destroy(),
delete this.container.player,this.container.destroy(),delete this.container);delete this.player},getLoaderInfo:function(){var a={},b=0;null!=this.player&&(b=this.player.bufferedPercent());a[this.options.id]={progress:b,weight:2,ref:this,type:"VIDEO"};return a},_reportProgress:function(a){var b=this.getLoaderInfo();!0==a&&(b[this.options.id].progress=1);null!=this.myParent().mediaLoader&&void 0!=this.myParent().mediaLoader&&this.myParent().mediaLoader.reportProgress(b)},_getVideoData:function(){var a=
{},b=stripFileExtension(this.options.filename),c=this.options.parent.options.videoFolder+b,b=this.options.parent.options.imageFolder+b;a.video=[{type:"video/mp4",src:c+".mp4"},{type:"video/webm",src:c+".webm"},{type:"video/ogg",src:c+".ogv"}];a.poster={src:b+"_first.jpg"};return a}});var DragNDropPlayer=new Class({Implements:[Options,Events],options:{data:null,draggable_IDs:"4wd bike van car cyclist pedestrian pole bin".split(" "),id:"DragNDropPlayer",parent:null,next:""},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.container=null;this.containerID="container_"+this.options.id;this.targets=[];this.correctAreas=[];this.addEvent("TIMELINE",this.handleNavigationEvent)},myParent:function(){return this.options.parent},show:function(){},hide:function(){},add:function(a,
b){document.getElementById(a);null==this.container&&(this.container=new Element("div",{id:this.containerID,styles:this.options.style}),this.container.inject($(a),b));this._prepareAreas();this._prepareDraggables()},remove:function(){this.hide();this.container.destroy();this.containerID=this.container=null},stop:function(){Array.each(this.draggables,function(a){a.stop()})},getScore:function(){var a=100/this.correctAreas.length,b=0,c=[];Array.each(this.draggables,function(a){c.append(a.drags)});Array.each(this.correctAreas,
function(a){Array.each(c,function(c){!0==c.isCorrect(a)&&b++})});log("Score: "+b,"%",b*a);return b*a},handleNavigationEvent:function(a){switch(a.next){case "Image.Ready":a=this.draggables.every(function(a){return!0==a.options.loaded}),log("Ready: ",a),!0==a&&this._showDraggables()}},_prepareAreas:function(){var a=this.options.data.areas;log("DropZones:",a);Array.each(a,function(a){a.player=new Shape(this,a);a.player.add(this.containerID);a.player.show();this.targets.push(a.player.shape);a.player.shape.store("angle",
a.angle);null!=a.correct&&void 0!=a.correct&&(a.player.shape.store("correct",a.correct),this.correctAreas.push(a.player.shape))}.bind(this))},_prepareDraggables:function(){this.draggables=[];Array.each(this.options.draggable_IDs,function(a,b){var c=this.myParent().options.imageFolder+"dragdrop/"+a+".png",e=this.myParent().options.imageFolder+"dragdrop/"+a+"_top.png",f=0;isEven(b)&&(f=1);c=new Draggable(this,{src:c,src_top:e,next:"Image.Ready",title:a,id:a,"class":"draggable",style:{left:425+100*f+
"px",top:50*b+"px"},droppables:this.targets});this.draggables.push(c);c.preload()}.bind(this))},_showDraggables:function(){Array.each(this.draggables,function(a){a.add(this.containerID);a.show()}.bind(this))}});var AudioPlayer=new Class({Implements:[Options,Events],options:{id:"element.id",src:"",next:"next.action",parent:null,preload:"false"},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.preloaded=!1;this.soundInstance=null;this.preloader=new createjs.PreloadJS;this.preloader.installPlugin(createjs.SoundJS);this.preloader.onProgress=function(){null!=this.myParent().mediaLoader&&void 0!=this.myParent().mediaLoader&&this.myParent().mediaLoader.reportProgress(this.getLoaderInfo())}.bind(this)},
myParent:function(){return this.options.parent},setSource:function(a){this.options.src=a},start:function(){!1==this.preloaded?(this.preloader.loadFile({src:this.options.src,id:this.options.id},!1),this.preloader.load(),this.preloader.onComplete=this._playSound()):this._playSound()},stop:function(){null!=this.soundInstance&&this.soundInstance.stop()},preload:function(){this.preloader.loadFile({src:this.options.src,id:this.options.id},!1);this.preloader.load();this.preloader.onComplete=this._preloadComplete()},
id:function(){return this.options.id},_playSound:function(){this.soundInstance=createjs.SoundJS.play(this.options.id);createjs.SoundJS.checkPlugin(!0)?this.soundInstance.onComplete=function(){this.myParent().fireEvent("TIMELINE",{type:"audio.finished",id:this.options.id,next:this.options.next})}.bind(this):alert("Sound plugin issue")}.protect(),_preloadComplete:function(){this.preloaded=!0}.protect(),getLoaderInfo:function(){var a={};a[this.options.id]={progress:this.preloader.progress,weight:1,ref:this,
type:"AUDIO"};return a}});var Button=new Class({Implements:[Options,Events],options:{style:{position:"absolute",top:"0px",left:"0px",width:"140px"},"class":"button",text:"button text",id:"element.id",next:"next.action",parent:null},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.buttonElement=new Element("button",{id:this.options.id,text:this.options.text,"class":this.options["class"]})},myParent:function(){return this.options.parent},add:function(a){this.containerID="container_"+this.options.id;this.container=
null;this.container=new Element("div",{id:this.containerID});this.container.inject($(a));this.buttonElement.inject(this.container);this.hide();this.buttonElement.setStyles(this.options.style);this.buttonElement.addEvent("click",function(){this.myParent().fireEvent("TIMELINE",{type:"button.clicked",id:this.options.id,next:this.options.next})}.bind(this))},remove:function(){this.hide();this.buttonElement.destroy();this.container.destroy()},show:function(){this.buttonElement.fade("hide");this.buttonElement.fade("in")},
hide:function(){this.buttonElement.fade("out")}});var CommentaryFeedback=new Class({Implements:[Options,Events],options:{style:{position:"absolute",top:"100px",left:"150px","background-color":"#464646","float":"left","border-radius":"1em 1em 1em 1em","text-align":"left",padding:"8px 8px 8px 8px","font-family":"Arial","-moz-border-radius":"0.5em 0.5em 0.5em 0.5em",background:"rgba(0, 0, 0, 0.6)",width:"300px",height:"200px",opacity:"0",visibility:"hidden"},data:["Q1","Q2","Q3"],id:"feedbackPanel",next:"next.action",parent:null},initialize:function(a,
b){this.setOptions(b);this.options.parent=a;this.container=new Element("div",{id:this.options.id});var c=new Element("ul",{id:"feedbackList"});log("Data:");log(this.options.data);Array.each(this.options.data,function(a){log(a);a=new Element("li",{html:a.text,onselectstart:"return false;"});c.adopt(a)}.bind(this));this.container.adopt(c)},myParent:function(){return this.options.parent},add:function(a){var b=document.getElementById(a).getElement("div[id=panelContainer]");null==b&&(b=new Element("div",
{id:"panelContainer"}),b.inject($(a)));b.adopt(this.panel);this.container.inject(b);this.container.setStyles(this.options.style)},remove:function(){this.container.destroy()},show:function(){0==this.container.style.opacity&&this.container.fade("in")},hide:function(){0<this.container.style.opacity&&this.container.fade("out")}});this.createjs=this.createjs||{};
(function(){var a=function(){this.init()};a.prototype={};var b=a.prototype;b.loaded=!1;b.canceled=!1;b.progress=0;b._item=null;b.onProgress=null;b.onLoadStart=null;b.onFileLoad=null;b.onFileProgress=null;b.onComplete=null;b.onError=null;b.getItem=function(){return this._item};b.init=function(){};b.load=function(){};b.cancel=function(){};b._sendLoadStart=function(){if(!this._isCanceled()&&this.onLoadStart)this.onLoadStart({target:this})};b._sendProgress=function(a){if(!this._isCanceled()){var b;if(a instanceof
Number)this.progress=a,b={loaded:this.progress,total:1};else if(b=a,this.progress=a.loaded/a.total,isNaN(this.progress)||Infinity==this.progress)this.progress=0;b.target=this;if(this.onProgress)this.onProgress(b)}};b._sendFileProgress=function(a){this._isCanceled()?this._cleanUp():this.onFileProgress&&(a.target=this,this.onFileProgress(a))};b._sendComplete=function(){if(!this._isCanceled()&&this.onComplete)this.onComplete({target:this})};b._sendFileComplete=function(a){!this._isCanceled()&&this.onFileLoad&&
(a.target=this,this.onFileLoad(a))};b._sendError=function(a){!this._isCanceled()&&this.onError&&(null==a&&(a={}),a.target=this,this.onError(a))};b._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1};b.toString=function(){return"[PreloadJS AbstractLoader]"};createjs.AbstractLoader=a})();this.createjs=this.createjs||{};
(function(){var a=function(a){this.initialize(a)},b=a.prototype=new createjs.AbstractLoader;a.IMAGE="image";a.SVG="svg";a.SOUND="sound";a.JSON="json";a.JAVASCRIPT="javascript";a.CSS="css";a.XML="xml";a.TEXT="text";a.TIMEOUT_TIME=8E3;b.useXHR=!0;b.stopOnError=!1;b.maintainScriptOrder=!0;b.next=null;b.typeHandlers=null;b.extensionHandlers=null;b._loadStartWasDispatched=!1;b._maxConnections=1;b._currentLoads=null;b._loadQueue=null;b._loadedItemsById=null;b._loadedItemsBySrc=null;b._targetProgress=0;
b._numItems=0;b._numItemsLoaded=null;b._scriptOrder=null;b._loadedScripts=null;b.TAG_LOAD_OGGS=!0;b.initialize=function(a){this._targetProgress=this._numItemsLoaded=this._numItems=0;this._paused=!1;this._currentLoads=[];this._loadQueue=[];this._scriptOrder=[];this._loadedScripts=[];this._loadedItemsById={};this._loadedItemsBySrc={};this.typeHandlers={};this.extensionHandlers={};this._loadStartWasDispatched=!1;this.useXHR=!1!=a&&null!=window.XMLHttpRequest;this.determineCapabilities()};b.determineCapabilities=
function(){var a=createjs.PreloadJS.BrowserDetect;null!=a&&(createjs.PreloadJS.TAG_LOAD_OGGS=a.isFirefox||a.isOpera)};a.isBinary=function(a){switch(a){case createjs.PreloadJS.IMAGE:case createjs.PreloadJS.SOUND:return!0;default:return!1}};b.installPlugin=function(a){if(!(null==a||null==a.getPreloadHandlers)){a=a.getPreloadHandlers();if(null!=a.types)for(var b=0,c=a.types.length;b<c;b++)this.typeHandlers[a.types[b]]=a.callback;if(null!=a.extensions){b=0;for(c=a.extensions.length;b<c;b++)this.extensionHandlers[a.extensions[b]]=
a.callback}}};b.setMaxConnections=function(a){this._maxConnections=a;this._paused||this._loadNext()};b.loadFile=function(a,b){null==a?this._sendError({text:"File is null."}):(this._addItem(a),!1!==b&&this.setPaused(!1))};b.loadManifest=function(a,b){var c;if(a instanceof Array){if(0==a.length){this._sendError({text:"Manifest is empty."});return}c=a}else{if(null==a){this._sendError({text:"Manifest is null."});return}c=[a]}for(var d=0,h=c.length;d<h;d++)this._addItem(c[d],!1);!1!==b&&this._loadNext()};
b.load=function(){this.setPaused(!1)};b.getResult=function(a){return this._loadedItemsById[a]||this._loadedItemsBySrc[a]};b.setPaused=function(a){(this._paused=a)||this._loadNext()};b.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0;this._loadedScripts.length=0};b._addItem=function(a){a=this._createLoadItem(a);null!=a&&(this._loadQueue.push(a),this._numItems++,this._updateProgress(),a.getItem().type==createjs.PreloadJS.JAVASCRIPT&&(this._scriptOrder.push(a.getItem()),
this._loadedScripts.push(null)))};b._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0);this._numItems==this._numItemsLoaded&&(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load.apply(this.next));for(;this._loadQueue.length&&this._currentLoads.length<this._maxConnections;)this._loadItem(this._loadQueue.shift())}};b._loadItem=function(a){a.onProgress=createjs.PreloadJS.proxy(this._handleProgress,this);
a.onComplete=createjs.PreloadJS.proxy(this._handleFileComplete,this);a.onError=createjs.PreloadJS.proxy(this._handleFileError,this);this._currentLoads.push(a);a.load()};b._handleFileError=function(a){a=a.target;var b=this._createResultData(a.getItem());this._numItemsLoaded++;this._updateProgress();this._sendError(b);this.stopOnError||(this._removeLoadItem(a),this._loadNext())};b._createResultData=function(a){var b={id:a.id,result:null,data:a.data,type:a.type,src:a.src};this._loadedItemsById[a.id]=
b;return this._loadedItemsBySrc[a.src]=b};b._handleFileComplete=function(a){a=a.target;var b=a.getItem(),c=this._createResultData(b);this._removeLoadItem(a);c.result=a instanceof createjs.XHRLoader?this._createResult(b,a.getResult()):b.tag;switch(b.type){case createjs.PreloadJS.IMAGE:if(a instanceof createjs.XHRLoader){var d=this;c.result.onload=function(){d._handleFileTagComplete(b,c)};return}break;case createjs.PreloadJS.JAVASCRIPT:if(this.maintainScriptOrder){this._loadedScripts[this._scriptOrder.indexOf(b)]=
b;this._checkScriptLoadOrder(a);return}}this._handleFileTagComplete(b,c)};b._checkScriptLoadOrder=function(){for(var a=this._loadedScripts.length,b=0;b<a;b++){var c=this._loadedScripts[b];if(null===c)break;if(!0!==c){var d=this.getResult(c.src),c=this.getResult(c.id);c.result=d.result;this._handleFileTagComplete(d,c);this._loadedScripts[b]=!0;b--;a--}}};b._handleFileTagComplete=function(a,b){this._numItemsLoaded++;a.completeHandler&&a.completeHandler(b);this._updateProgress();this._sendFileComplete(b);
this._loadNext()};b._removeLoadItem=function(a){for(var b=this._currentLoads.length,c=0;c<b;c++)if(this._currentLoads[c]==a){this._currentLoads.splice(c,1);break}};b._createResult=function(a,b){var c=null,d;switch(a.type){case createjs.PreloadJS.IMAGE:c=this._createImage();break;case createjs.PreloadJS.SOUND:c=a.tag||this._createAudio();break;case createjs.PreloadJS.CSS:c=this._createLink();break;case createjs.PreloadJS.JAVASCRIPT:c=this._createScript();break;case createjs.PreloadJS.SVG:var c=this._createSVG(),
h=this._createXML(b,"image/svg+xml");c.appendChild(h);break;case createjs.PreloadJS.XML:d=this._createXML(b,"text/xml");break;case createjs.PreloadJS.JSON:case createjs.PreloadJS.TEXT:d=b}return c?(a.type==createjs.PreloadJS.CSS?c.href=a.src:a.type!=createjs.PreloadJS.SVG&&(c.src=a.src),c):d};b._createXML=function(a,b){var c;window.DOMParser?(c=new DOMParser,c=c.parseFromString(a,b)):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a));return c};b._handleProgress=function(a){a=a.target;
var b=this._createResultData(a.getItem());b.progress=a.progress;this._sendFileProgress(b);this._updateProgress()};b._updateProgress=function(){var a=this._numItemsLoaded/this._numItems,b=this._numItems-this._numItemsLoaded;if(0<b){for(var c=0,d=0,h=this._currentLoads.length;d<h;d++)c+=this._currentLoads[d].progress;a+=c/b*(b/this._numItems)}this._sendProgress({loaded:a,total:1})};b._createLoadItem=function(a){var b={};switch(typeof a){case "string":b.src=a;break;case "object":a instanceof HTMLAudioElement?
(b.tag=a,b.src=b.tag.src,b.type=createjs.PreloadJS.SOUND):b=a}b.ext=this._getNameAfter(b.src,".");b.type||(b.type=this.getType(b.ext));if(null==b.id||""==b.id)b.id=b.src;if(a=this.typeHandlers[b.type]||this.extensionHandlers[b.ext]){a=a(b.src,b.type,b.id,b.data);if(!1===a)return null;!0!==a&&(null!=a.src&&(b.src=a.src),null!=a.id&&(b.id=a.id),null!=a.tag&&a.tag.load instanceof Function&&(b.tag=a.tag));b.ext=this._getNameAfter(b.src,".")}a=this.useXHR;switch(b.type){case createjs.PreloadJS.JSON:case createjs.PreloadJS.XML:case createjs.PreloadJS.TEXT:a=
!0;break;case createjs.PreloadJS.SOUND:"ogg"==b.ext&&createjs.PreloadJS.TAG_LOAD_OGGS&&(a=!1)}return!0==this.useXHR&&(b.type==createjs.PreloadJS.IMAGE||b.type==createjs.PreloadJS.SVG)?(b=this._createTagItem(b),b.useXHR=!0,b):a?new createjs.XHRLoader(b):b.tag?new createjs.TagLoader(b):this._createTagItem(b)};b._createTagItem=function(a){var b,c="src",d=!1;switch(a.type){case createjs.PreloadJS.IMAGE:b=this._createImage();break;case createjs.PreloadJS.SOUND:b=this._createAudio();break;case createjs.PreloadJS.CSS:c=
"href";d=!0;b=this._createLink();break;case createjs.PreloadJS.JAVASCRIPT:d=!0;b=this._createScript();break;case createjs.PreloadJS.SVG:c="data",b=this._createSVG()}a.tag=b;return new createjs.TagLoader(a,c,d)};b.getType=function(a){switch(a){case "jpeg":case "jpg":case "gif":case "png":return createjs.PreloadJS.IMAGE;case "ogg":case "mp3":case "wav":return createjs.PreloadJS.SOUND;case "json":return createjs.PreloadJS.JSON;case "xml":return createjs.PreloadJS.XML;case "css":return createjs.PreloadJS.CSS;
case "js":return createjs.PreloadJS.JAVASCRIPT;case "svg":return createjs.PreloadJS.SVG;default:return createjs.PreloadJS.TEXT}};b._getNameAfter=function(a,b){var c=a.lastIndexOf(b),c=a.substr(c+1),d=c.lastIndexOf(/[\b|\?|\#|\s]/);return-1==d?c:c.substr(0,d)};b._createImage=function(){return document.createElement("img")};b._createSVG=function(){var a=document.createElement("object");a.type="image/svg+xml";return a};b._createAudio=function(){var a=document.createElement("audio");a.autoplay=!1;a.type=
"audio/ogg";return a};b._createScript=function(){var a=document.createElement("script");a.type="text/javascript";return a};b._createLink=function(){var a=document.createElement("link");a.type="text/css";a.rel="stylesheet";return a};b.toString=function(){return"[PreloadJS]"};a.proxy=function(a,b){return function(c){return a.apply(b,arguments)}};createjs.PreloadJS=a;var c=function(){};c.init=function(){var a=navigator.userAgent;c.isFirefox=-1<a.indexOf("Firefox");c.isOpera=null!=window.opera;c.isIOS=
-1<a.indexOf("iPod")||-1<a.indexOf("iPhone")||-1<a.indexOf("iPad")};c.init();createjs.PreloadJS.BrowserDetect=c})();this.createjs=this.createjs||{};
(function(){var a=function(a,b,f){this.init(a,b,f)},b=a.prototype=new createjs.AbstractLoader;b._srcAttr=null;b._loadTimeOutTimeout=null;b.tagCompleteProxy=null;b.init=function(a,b,f){this._item=a;this._srcAttr=b||"src";this.useXHR=!0==f;this.isAudio=a.tag instanceof HTMLAudioElement;this.tagCompleteProxy=createjs.PreloadJS.proxy(this._handleTagLoad,this)};b.cancel=function(){this.canceled=!0;this._clean();var a=this.getItem();null!=a&&(a.src=null)};b.load=function(){this.useXHR?this.loadXHR():this.loadTag()};
b.loadXHR=function(){var a=this.getItem(),a=new createjs.XHRLoader(a);a.onProgress=createjs.PreloadJS.proxy(this._handleProgress,this);a.onFileLoad=createjs.PreloadJS.proxy(this._handleXHRComplete,this);a.onComplete=createjs.PreloadJS.proxy(this._handleXHRComplete,this);a.onError=createjs.PreloadJS.proxy(this._handleLoadError,this);a.load()};b._handleXHRComplete=function(a){if(!this._isCanceled()){this._clean();a.target.onFileLoad=null;a.target.onComplete=null;var b=a.target.getItem();a.target.getResult();
b.type==createjs.PreloadJS.IMAGE?(b.tag.onload=createjs.PreloadJS.proxy(this._sendComplete,this),b.tag.src=b.src):(b.tag[this._srcAttr]=b.src,this._sendComplete())}};b._handleLoadError=function(a){a.error&&101==a.error.code?this.loadTag():(this._clean(),this._sendError(a))};b.loadTag=function(){var a=this.getItem(),b=a.tag;clearTimeout(this._loadTimeOutTimeout);this._loadTimeOutTimeout=setTimeout(createjs.PreloadJS.proxy(this._handleLoadTimeOut,this),createjs.PreloadJS.TIMEOUT_TIME);this.isAudio&&
(b.src=null,b.preload="auto",b.setAttribute("data-temp","true"));b.onerror=createjs.PreloadJS.proxy(this._handleLoadError,this);b.onprogress=createjs.PreloadJS.proxy(this._handleProgress,this);this.isAudio?(b.onstalled=createjs.PreloadJS.proxy(this._handleStalled,this),b.addEventListener("canplaythrough",this.tagCompleteProxy,!1)):b.onload=createjs.PreloadJS.proxy(this._handleTagLoad,this);b[this._srcAttr]=a.src;a.type==createjs.PreloadJS.SVG&&document.getElementsByTagName("body")[0].appendChild(b);
a=a.type==createjs.PreloadJS.SOUND&&"ogg"==a.ext&&createjs.PreloadJS.BrowserDetect.isFirefox;null!=b.load&&!a&&b.load()};b._handleLoadTimeOut=function(){this._clean();this._sendError()};b._handleStalled=function(){};b._handleLoadError=function(){this._clean();this._sendError()};b._handleTagLoad=function(){if(!this._isCanceled()){var a=this.getItem().tag;clearTimeout(this._loadTimeOutTimeout);this.loaded||this.isAudio&&4!==a.readyState||(this.getItem().type==createjs.PreloadJS.SVG&&document.getElementsByTagName("body")[0].removeChild(a),
this.loaded=!0,this._clean(),this._sendComplete())}};b._clean=function(){clearTimeout(this._loadTimeOutTimeout);var a=this.getItem().tag;a.onload=null;a.removeEventListener&&a.removeEventListener("canplaythrough",this.tagCompleteProxy,!1);a.onstalled=null;a.onprogress=null;a.onerror=null};b._handleProgress=function(a){clearTimeout(this._loadTimeOutTimeout);if(this.isAudio){a=this.getItem();if(null==a.buffered)return;a={loaded:0<a.buffered.length?a.buffered.end(0):0,total:a.duration}}this._sendProgress(a)};
b.toString=function(){return"[PreloadJS TagLoader]"};createjs.TagLoader=a})();this.createjs=this.createjs||{};
(function(){var a=function(a){this.init(a)},b=a.prototype=new createjs.AbstractLoader;b._wasLoaded=!1;b._request=null;b._loadTimeOutTimeout=null;b._xhrLevel=null;b.init=function(a){this._item=a;this._createXHR(a)};b.getResult=function(){try{return this._request.responseText}catch(a){}return this._request.response};b.cancel=function(){this.canceled=!0;this._clean();this._request.abort()};b.load=function(){if(null==this._request)this.handleError();else{1==this._xhrLevel&&(this._loadTimeOutTimeout=setTimeout(createjs.PreloadJS.proxy(this.handleTimeout,
this),createjs.PreloadJS.TIMEOUT_TIME));this._request.onloadstart=createjs.PreloadJS.proxy(this.handleLoadStart,this);this._request.onprogress=createjs.PreloadJS.proxy(this.handleProgress,this);this._request.onabort=createjs.PreloadJS.proxy(this.handleAbort,this);this._request.onerror=createjs.PreloadJS.proxy(this.handleError,this);this._request.ontimeout=createjs.PreloadJS.proxy(this.handleTimeout,this);this._request.onload=createjs.PreloadJS.proxy(this.handleLoad,this);this._request.onreadystatechange=
createjs.PreloadJS.proxy(this.handleReadyStateChange,this);try{this._request.send()}catch(a){this._sendError({source:a})}}};b.handleProgress=function(a){0<a.loaded&&0==a.total||this._sendProgress({loaded:a.loaded,total:a.total})};b.handleLoadStart=function(){clearTimeout(this._loadTimeOutTimeout);this._sendLoadStart()};b.handleAbort=function(){this._clean();this._sendError()};b.handleError=function(){this._clean();this._sendError()};b.handleReadyStateChange=function(){4==this._request.readyState&&
this.handleLoad()};b._checkError=function(){switch(parseInt(this._request.status)){case 404:case 0:return!1}return this._hasResponse()||this._hasTextResponse()||this._hasXMLResponse()};b._hasResponse=function(){return null!=this._request.response};b._hasTextResponse=function(){try{return null!=this._request.responseText}catch(a){return!1}};b._hasXMLResponse=function(){try{return null!=this._request.responseXML}catch(a){return!1}};b.handleLoad=function(){this.loaded||(this.loaded=!0,this._checkError()?
(this._clean(),this._sendComplete()):this.handleError())};b.handleTimeout=function(){this._clean();this._sendError()};b._createXHR=function(a){this._xhrLevel=1;window.ArrayBuffer&&(this._xhrLevel=2);if(window.XMLHttpRequest)this._request=new XMLHttpRequest;else try{this._request=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(b){return null}a.type==createjs.PreloadJS.TEXT&&this._request.overrideMimeType&&this._request.overrideMimeType("text/plain; charset=x-user-defined");this._request.open("GET",a.src,
!0);createjs.PreloadJS.isBinary(a.type)&&(this._request.responseType="arraybuffer");return!0};b._clean=function(){clearTimeout(this._loadTimeOutTimeout);var a=this._request;a.onloadstart=null;a.onprogress=null;a.onabort=null;a.onerror=null;a.onload=null;a.ontimeout=null;a.onloadend=null;a.onreadystatechange=null;clearInterval(this._checkLoadInterval)};b.toString=function(){return"[PreloadJS XHRLoader]"};createjs.XHRLoader=a})();var flashLoaded=!1,swiffFinished=null,introFinished=null;function flashLoaded(){flashLoaded=!0;console.log("Flash Is ready")}function jsIsReady(){return!0}
var SequencePlayer=new Class({Implements:[Options,Events],options:{audioFolder:"media/sound/",videoFolder:"media/video/",imageFolder:"media/images/",flashFolder:"media/flash/",parent:null},initialize:function(a,b,c){this.setOptions(c);this.options.parent=a;this._resetVariables();this.fromMenu=this.repeating=!1;this.mediaLoader=new MediaLoader(this,{parentElementID:driveSmartDivID});this.addEvent("TIMELINE",this.handleNavigationEvent)},myParent:function(){return this.options.parent},start:function(a){this.currentSequence=
Array.clone(a);this.moduleInfo=this.myParent().getModuleInfo();this.sequenceState={moduleID:this.moduleInfo.moduleID,id:this.moduleInfo.currentSequenceID,completed:!1,score:[]};log("Starting SEQUENCE: "+this.moduleInfo.currentSequenceID);this._setupMedia()},_setupMedia:function(){this._setupSequence(this.currentSequence);this.mediaLoader.options.next="Media.ready";this.mediaLoader.start(!0)},_nextStep:function(){if(null!=this.currentStep){var a=this.currentStep.score;log("Score:",a);null!=a&&void 0!=
a&&this.sequenceState.score.push(a)}if(0<this.currentSequence.length){var b=this.currentSequence.shift();this.currentStep=b;switch(b.attributes.fmt){case "Menu":var c="Menu.container",a=new Element("div",{id:c});a.inject($(driveSmartDivID));b.image.add(c);var e=new Element("h1",{html:this.moduleInfo.moduleTitle,"class":"main-title"});e.inject(a);b.data.style={left:"10px",top:"40px"};e=new MenuItems(this,b.data);e.add(c);e.show();(new Element("h2",{html:"Overall score: "+(100*userTracker.getTotalScore()).toInt()+
"/100",styles:{position:"absolute",left:"390px",top:"30px"}})).inject(a);break;case "SequenceIntro":log("From Menu:",this.fromMenu);this.fromMenu=!1;c="SequenceIntro.container";a=new Element("div",{id:c});a.inject($(driveSmartDivID));b.image.add(c);b.image.show();b.previewImage.add(c);b.previewImage.show();e=new Element("h1",{html:this.moduleInfo.moduleTitle,styles:{left:"0px",top:"20%"},"class":"module-title"});e.inject(a);c=userTracker.getModuleProgress(this.moduleInfo.moduleID);(new Element("h1",
{html:"Exercise "+this.sequenceState.id+" of "+c.total,styles:{left:"0",top:"350px"},"class":"sequence-title"})).inject(a);c=moduleProgressSetup(this.moduleInfo.moduleID);c.setStyles({left:0,top:"380px"});c.inject(a);this._setupButton({text:"Continue","class":"button next",next:"SequenceIntro.done",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});this._setupButton({text:"Main Menu","class":"button star",next:"MainMenuIntro.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y-
45}});b.player.options.next="";b.player.start();break;case "ModuleIntro":this._moduleIntroSetup(b);break;case "CommentaryIntro":c="CommentaryIntro.container";a=new Element("div",{id:c});a.inject($(driveSmartDivID));b.image.add(c);b.image.show();this._setupButton({text:"Record","class":"button record",next:"CommentaryIntro.done",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});void 0!=this.currentSequence[0].expertAudio&&this._setupButton({text:"Expert commentary","class":"button play",
next:"CommentaryIntro.expert.clicked",style:{left:20,top:this.buttonPosition.y,width:"195px"}});this.recorder=new Recorder(this,{swiff:{id:"Commentary"},src:this.options.flashFolder+"commentary.swf"});this.recorder.add(driveSmartDivID);b.player.options.next="";b.player.start();break;case "PlayVideo":this._removeImages();this._removeButtons();this._cleanUp();this._hideInteractions();b.player.options.next="PlayVideo.done";b.player.show();b.player.start();this._hideOtherVideos(b.player.playerID);break;
case "ConIntro":this._removeImages();this._removeButtons();this._cleanUp();this._hideInteractions();b.swiff.options.next="ConIntro.done";introFinished=function(){console.log("*********************  introDone");this.fireEvent("TIMELINE",{type:"swiff.done",id:"intro",next:b.swiff.options.next})}.bind(this);this.activeSwiff=b.swiff;b.swiff.show();b.swiff.start();!0==this.repeating&&this._setupButton({text:"Skip","class":"button next",next:"ConIntro.done.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});
break;case "ConActivity":this._removeImages();this._removeButtons();this._cleanUp();this._hideInteractions();swiffFinished=function(a){console.log("*********************Con activity done: ",a);this.fireEvent("TIMELINE",{type:"swiff.done",id:"ConActivity",next:"ConActivity.done",score:a})}.bind(this);this.activeSwiff=b.swiff;b.swiff.show();b.swiff.attributes.level=this.conLevel;b.swiff.startConActivity(b.swiff.attributes);this._setupButton({text:"Cancel","class":"button next",next:"ConActivity.cancel.clicked",
style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});break;case "ConContinue":this._setupButton({text:"Continue","class":"button next",next:"ConContinue.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});break;case "Question":b.player.options.next="Question.done";b.player.start();"hidescreen"==b.attributes.cmd&&this.activeVideo.obscure();break;case "QuestionUser":this._removeInteractions();null!=b.attributes.resp&&void 0!=b.attributes.resp&&(b.data.responses=b.attributes.resp);
this.interactions=this._setupQuestions(b.data);this._setupButton({text:"Done","class":"button save",next:"QuestionUser.done",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});break;case "QuestionFeedback":this._removeButtons();this._showInteractions();b.score=this.interactions.showCorrect();b.player.options.next="QuestionFeedback.done";b.player.start();"MudScreen"==b.attributes.show&&this.activeVideo.obscure();break;case "PlayAudio":b.player.options.next="PlayAudio.done";b.player.start();
break;case "Continue":this._setupButton({text:"Continue","class":"button next",next:"Continue.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});this._setupButton({text:"Main Menu","class":"button star",next:"MainMenu.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y-45}});this._setupButton({text:"Repeat","class":"button back",next:"Repeat.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y-90}});this._updateUserProgress();break;case "End.Module.Continue":b.player.start();
this._setupButton({text:"Continue","class":"button next",next:"End.Module.Continue.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});this._setupButton({text:"Repeat","class":"button back",next:"Repeat.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y-90}});this._updateUserProgress();break;case "Commentary":this._removeButtons();!0==b.playExpert?(a=this.currentStep.expertAudio,void 0!=a&&(a.options.next="",a.start()),b.playExpert=!1):this.recorder.startRecording();
b.player.options.next="Commentary.recording.done";b.player.show();b.player.volume(0.2);this._hideOtherVideos(b.player.playerID);b.player.start();break;case "KeyRisk":this._removeInteractions();b.player.options.next="Risks.ready";this.shapes=new KeyRiskPlayer(this,{});this.shapes.options.data={areas:b.areas};this.shapes.add(this.activeVideo.containerID);b.player.start();break;case "KRFeedback":this._removeButtons();b.image.add(this.shapes.container.id);b.image.show();b.player.options.next="KRFeedback.done";
b.player.start();break;case "Cameo":a=this.options.imageFolder+"cameo/visor_bkg.png";this.cameo_image=new ImagePlayer(this,{src:a,next:"Cameo.visor.image.ready",title:"Visor",id:"visor",style:{left:"170px",height:"0px"}});a=this.options.imageFolder+"cameo/visor_mask.png";this.cameo_image_mask=new ImagePlayer(this,{src:a,next:"Cameo.visor.image.ready",title:"Visor",id:"visor",style:{left:"170px",height:"0px"}});this.cameo_image.preload();this.cameo_image_mask.preload();break;case "DragNDrop":b.emptyBkg.add(this.activeVideo.containerID);
b.emptyBkg.show();b.dragNDrop=new DragNDropPlayer(this,{});a=new ImagePlayer(this,{src:this.options.imageFolder+"dragdrop/panel_bkg.png",style:{left:"427px",top:"0px",position:"absolute"}});a.preload();a.add(this.activeVideo.containerID);a.show();b.dragNDrop.options.data={areas:b.areas};b.dragNDrop.add(this.activeVideo.containerID);b.player.start();this._setupButton({text:"Done","class":"button next",next:"DragNDrop.done",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});break;case "DragNDropFeedback":0<
this.currentSequence.length&&log("ERROR - DragNDropFeedback must be last in the sequence"),b.image.add(this.activeVideo.containerID),b.image.show(),b.player.start(),this._setupButton({text:"Continue","class":"button next",next:"Continue.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}}),this._setupButton({text:"Main Menu","class":"button star",next:"MainMenu.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y-45}}),this._setupButton({text:"Repeat","class":"button back",
next:"Repeat.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y-90}}),this._updateUserProgress()}}else log("******** ERROR - Missing Continue STEP in this sequence")},handleNavigationEvent:function(a){switch(a.next){case "Media.ready":case "PlayVideo.done":case "Question.done":case "QuestionFeedback.done":case "PlayAudio.done":this._nextStep();break;case "SequenceIntro.done":this._removeImages();this._removeButtons();this._cleanUp();this._nextStep();break;case "KRFeedback.continue.done":this._removeRisks();
this._removeImages();this._removeButtons();this._cleanUp();this._nextStep();break;case "Skip.done":this._removeImages();this._removeButtons();this._cleanUp();this._nextStep();break;case "QuestionUser.done":this.interactions.lockAnswer();this._removeButtons();this._nextStep();break;case "Risks.ready":this._setupButton({text:"Done","class":"button save",next:"Risks.done",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});break;case "Risks.done":this.activeVideo.container.removeEvents("click");
this.currentStep.score=this.shapes.getScore();this._nextStep();break;case "ConActivity.done":this.currentStep.score=a.score/100;this._nextStep();break;case "KRFeedback.done":this._setupButton({text:"Continue","class":"button next",next:"KRFeedback.continue.done",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});break;case "Continue.clicked":this.reset();this.repeating=!1;this.myParent().fireEvent("SEQUENCE",{type:"sequence.event",next:"sequence.next"});break;case "ConActivity.cancel.clicked":this.currentStep.score=
void 0;case "Repeat.clicked":this._removeVideos();this._removeImages();this._removeButtons();this._cleanUp();this._removeInteractions();this.repeating=!0;this.myParent().fireEvent("SEQUENCE",{type:"sequence.event",next:"sequence.repeat"});break;case "End.Module.Continue.clicked":case "MainMenu.clicked":case "MainMenuIntro.clicked":this._removeVideos();this._removeImages();this._removeButtons();this._cleanUp();this._removeInteractions();this.repeating=!1;this.myParent().fireEvent("SEQUENCE",{type:"sequence.event",
next:"sequence.exit"});break;case "Cameo.visor.image.ready":this.cameo_image.options.loaded&&this.cameo_image_mask.options.loaded&&(this.cameo_image.add(this.currentStep.player.containerID,"before"),this.cameo_image.show(),this.cameo_image.tween("203px","0px",1,"height",300,"ignore","Cameo.visor.tween.done"),this.cameo_image_mask.add(this.currentStep.player.containerID,"after"),this.cameo_image_mask.show(),this.cameo_image_mask.tween("203px","0px",1,"height",300,"ignore",""));break;case "Cameo.visor.tween.done":this.currentStep.player.options.next=
"Cameo.done";this.currentStep.player.show();this.currentStep.player.start();break;case "Cameo.done":this.currentStep.player.hide(0);this.cameo_image.tween("0px","203px",1,"height",300,"ignore","");this.cameo_image_mask.remove();this._nextStep();break;case "CommentaryIntro.expert.clicked":a=this.currentSequence[0],"Commentary"==a.attributes.fmt?a.playExpert=!0:log("ERROR - next step must be Commentary after CommentaryIntro");case "CommentaryIntro.done":this._removeInteractions();this._removeButtons();
this._cleanUp();this._nextStep();break;case "Commentary.recording.done":log("Ok recorder stopped");this._updateUserProgress();this.recorder.stopRecording();a=this.currentStep.feedbackAudio;void 0!=a&&(a.options.next="",a.start());void 0!=this.currentStep.data&&(this.currentStep.feedbackPanel=new CommentaryFeedback(this,this.currentStep.data),this.currentStep.feedbackPanel.add(driveSmartDivID),this.currentStep.feedbackPanel.show());this._setupButton({text:"Your commentary","class":"button play",next:"Commentary.replay.clicked",
style:{left:20,top:this.buttonPosition.y,width:"195px"}});void 0!=this.currentStep.expertAudio&&this._setupButton({text:"Expert commentary","class":"button play",next:"Commentary.expert.clicked",style:{left:20,top:this.buttonPosition.y-45,width:"195px"}});this._setupButton({text:"Continue","class":"button next",next:"Continue.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});this._setupButton({text:"Repeat","class":"button record",next:"Commentary.repeat.clicked",style:{left:this.buttonPosition.x,
top:this.buttonPosition.y-90}});this._setupButton({text:"Main Menu","class":"button star",next:"MainMenu.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y-45}});break;case "Commentary.replay.clicked":this._removeFeedbackPanel();this._removeButtons();this._cleanUp();this.recorder.startPlayback();this.currentStep.player.show();this.currentStep.player.options.next="Commentary.recording.done";this.currentStep.player.volume(0.2);this.currentStep.player.start();break;case "Commentary.expert.clicked":this._removeFeedbackPanel();
this._removeButtons();this._cleanUp();a=this.currentStep.expertAudio;void 0!=a&&(a.options.next="",a.start());this.currentStep.player.show();this.currentStep.player.options.next="Commentary.recording.done";this.currentStep.player.volume(0.2);this.currentStep.player.start();break;case "Commentary.repeat.clicked":this._removeFeedbackPanel();this._removeButtons();this._cleanUp();this.currentSequence.unshift(this.currentStep);this._nextStep();break;case "DragNDrop.done":this._removeButtons();this._cleanUp();
this.currentStep.dragNDrop.stop();this.currentStep.score=this.currentStep.dragNDrop.getScore();a=this.currentSequence[0];"DragNDropFeedback"!=a.attributes.fmt&&log("ERROR - next step must be DragNDropFeedback after DragNDrop");this._nextStep();break;case "Menu.item.clicked":this._removeImages();this._removeButtons();this._cleanUp();this.myParent().myParent().setOptions({moduleID:a.id});this.myParent().fireEvent("SEQUENCE",{type:"sequence.event",next:"module.selected"});break;case "ConIntro.done":this._removeButtons();
introFinished=null;this.currentStep.player.start();this._setupButton({text:"Start","class":"button next",next:"ConIntro.done.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});break;case "ConIntro.done.clicked":case "ConContinue.clicked":this._removeButtons(),this._removeCurrentSwiff(),this._cleanUp(),this._nextStep()}},getSequenceState:function(){return this.sequenceState},_setupButton:function(a){a.id="button_"+this.buttons.length;a["class"]="button";a=new Button(this,a);a.add(driveSmartDivID);
a.show();this.buttons.push(a)}.protect(),_setupQuestions:function(a){a=new Questions(this,a);a.add(driveSmartDivID,"bottom");a.show();return a}.protect(),_setupSequence:function(a){new Hash({});Array.each(a,function(a,c){this._setupStepMedia(a,c)}.bind(this));log("---------------------------- Finished setting up media from xml")}.protect(),_setupStepScoring:function(){}.protect(),_setupStepMedia:function(a,b){var c=a.attributes.fmt;Array.each(a.childNodes,function(e,f){void 0!=a.player&&log("!!!!!!!!!!!!!!!!!!!!! ERROR - Two players in this step !!!!!!!!!!!!!!!!!!!!!!!!!"+
c);switch(e.name){case "Video":if(""!=e.value){var g=e.value,d=null;if("Cameo"==c)var d={left:"315px",top:"20px",width:"240",height:"175"},h="240px",k="175px";else d={width:"640",height:"480",left:"0",top:"0"},h="240px",k="175px";a.player=new VideoPlayer(this,{id:"video_"+f+"_"+b,next:"not.set",style:d,filename:g,width:h,height:k});this.mediaLoader.register(a.player.getLoaderInfo());this.videos.push(a.player)}break;case "Audio":""!=e.value&&(g=this.options.audioFolder+stripFileExtension(e.value),
a.player=new AudioPlayer(this,{next:"not.set",id:"audio_"+f+"_"+b,src:g+".mp3|"+g+".ogg",preload:"false"}),this.mediaLoader.register(a.player.getLoaderInfo()));break;case "FeedbackAudio":""!=e.value&&(g=this.options.audioFolder+stripFileExtension(e.value),a.feedbackAudio=new AudioPlayer(this,{next:"not.set",id:"audio_"+f+"_"+b,src:g+".mp3|"+g+".ogg",preload:"false"}),this.mediaLoader.register(a.feedbackAudio.getLoaderInfo()));break;case "ExpertAudio":""!=e.value&&(g=this.options.audioFolder+stripFileExtension(e.value),
a.expertAudio=new AudioPlayer(this,{next:"not.set",id:"audio_"+f+"_"+b,src:g+".mp3|"+g+".ogg",preload:"false"}),this.mediaLoader.register(a.expertAudio.getLoaderInfo()));break;case "DoneAudio":""!=e.value&&(g=this.options.audioFolder+stripFileExtension(e.value),a.doneAudio=new AudioPlayer(this,{next:"not.set",id:"audio_"+f+"_"+b,src:g+".mp3|"+g+".ogg",preload:"false"}),this.mediaLoader.register(a.doneAudio.getLoaderInfo()));break;case "Preview":""!=e.value&&(g=this.options.imageFolder+e.value,a.previewImage=
new ImagePlayer(this,{src:g,title:"Preview",id:"preview_image",style:{width:"40%",height:"40%",top:"148px"}}),this.mediaLoader.register(a.previewImage.getLoaderInfo()));break;case "Image":""!=e.value&&(g=this.options.imageFolder+e.value,a.image=new ImagePlayer(this,{src:g,title:"Image",id:"image"+f+"_"+b}),this.mediaLoader.register(a.image.getLoaderInfo()));break;case "EmptyBkg":""!=e.value&&(g=this.options.imageFolder+e.value,a.emptyBkg=new ImagePlayer(this,{src:g,title:"BkgImage",id:"image"+f+"_"+
b}),this.mediaLoader.register(a.emptyBkg.getLoaderInfo()));break;case "Items":var m={data:[]};Array.each(e.childNodes,function(a){m.data.push({text:a.value,description:a.attributes.description,moduleID:a.attributes.moduleID,preview:a.attributes.preview,showProgress:a.attributes.showProgress})});a.data=m;break;case "FeedbackText":var j={data:[]};Array.each(e.childNodes,function(a){j.data.push({text:a.value})});a.data=j;break;case "Inter":var n={data:[],style:this.panelPosition};Array.each(e.childNodes,
function(a){n.data.push({text:a.value,correct:a.attributes.correct})});a.data=n;break;case "DropAreas":case "Areas":g=e.childNodes;a.areas=[];Array.each(g,function(b){a.areas.push({id:b.attributes.id,data:b.attributes.data,angle:b.attributes.angle,correct:b.attributes.correct})});break;case "RotateAreas":g=e.childNodes;a.rotateZones=[];Array.each(g,function(b){a.rotateZones.push({id:b.attributes.id,data:b.attributes.data,angle:b.attributes.angle})});break;case "Zones":a.zones=e.attributes.data;break;
case "Swiff":log(e.value),a.swiff=new SwiffPlayer(this,{swiff:{id:"swiff.id."+f+"_"+b},src:this.options.flashFolder+e.value,id:"swiff"+f+"_"+b}),a.swiff.attributes=e.attributes,this.swiffs.push(a.swiff),this.mediaLoader.register(a.swiff.getLoaderInfo())}}.bind(this))}.protect(),_cleanUp:function(){null!=this.currentStep&&(null!=this.currentStep.player&&this.currentStep.player.stop(),void 0!=this.currentStep.feedbackAudio&&this.currentStep.feedbackAudio.stop(),void 0!=this.currentStep.expertAudio&&
this.currentStep.expertAudio.stop());$("debugContainer");var a=$("SequenceIntro.container");null!=a&&a.destroy();a=$("CommentaryIntro.container");null!=a&&a.destroy();a=$("Menu.container");null!=a&&a.destroy()}.protect(),_removeImages:function(){var a=document.getElementById("imageContainer");null!=a&&a.destroy()}.protect(),_removeButtons:function(){Array.each(this.buttons,function(a){a.remove()});this.buttons.empty()}.protect(),_removeInteractions:function(){null!=this.interactions&&this.interactions.remove();
var a=$("panelContainer");null!=a&&a.destroy();this.interactions=null}.protect(),_hideInteractions:function(){null!=this.interactions&&this.interactions.hide()}.protect(),_showInteractions:function(){null!=this.interactions&&this.interactions.show()}.protect(),_removeVideos:function(){this.activeVideo=null;Array.each(this.videos,function(a){a.remove();delete null});this.videos.empty()}.protect(),_hideOtherVideos:function(a){Array.each(this.videos,function(b){b.playerID==a?this.activeVideo=b:b.hide()}.bind(this))}.protect(),
_removeSwiffs:function(){null!=this.recorder&&this.recorder.remove();this.recorder=null;Array.each(this.swiffs,function(a){log("Removing swiff: ",a);a.remove();delete null});this.swiffs.empty();this.activeSwiff=null}.protect(),_removeCurrentSwiff:function(){null!=this.recorder&&this.recorder.remove();this.recorder=null;this.activeSwiff.remove();this.activeSwiff=null}.protect(),_removeFeedbackPanel:function(){void 0!=this.currentStep&&void 0!=this.currentStep.feedbackPanel&&this.currentStep.feedbackPanel.remove()}.protect(),
_removeRisks:function(){void 0!=this.shapes&&null!=this.shapes&&this.shapes.remove();this.shapes=null}.protect(),_updateUserProgress:function(){this.sequenceState.completed=!0;userTracker.updateSequenceProgress(this.sequenceState)}.protect(),onLoad:function(){log("Called Loaded")},isReady:function(){log("Is ready ?");return!0},reset:function(){this.currentSequence.empty();this._removeFeedbackPanel();this.mediaLoader.remove();this._removeImages();this._removeRisks();this._removeButtons();this._removeSwiffs();
this._removeInteractions();this._cleanUp();this._removeVideos();this._resetVariables()},_resetVariables:function(){this.currentSequence=[];this.cameo_image=this.cameo_image_mask=this.currentStep=this.sequenceState=null;this.buttons=[];this.interactions=null;this.videos=[];this.correctBkg=this.emptyBkg=null;this.swiffs=[];this.recorder=this.cameo_image=this.shapes=this.activeVideo=this.activeSwiff=null;this.conLevel=1;this.playConLevelAudio=!1;introFinished=swiffFinished=null;this.buttonPosition={x:480,
y:415};this.panelPosition={left:"5%",top:"25%"}}.protect(),_moduleIntroSetup:function(a){log("From Menu: ",this.fromMenu);var b=new Element("div",{id:"SequenceIntro.container"});b.inject($(driveSmartDivID));a.image.add("SequenceIntro.container");a.image.show();a.previewImage.add("SequenceIntro.container");a.previewImage.show();(new Element("h1",{html:this.moduleInfo.moduleTitle,styles:{left:"0px",top:"20%"},"class":"module-title"})).inject(b);userTracker.getModuleProgress(this.moduleInfo.moduleID);
var c=moduleProgressSetup(this.moduleInfo.moduleID);c.setStyles({left:0,top:"380px"});c.inject(b);this._setupButton({text:"Continue","class":"button next",next:"Continue.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y}});this._setupButton({text:"Main Menu","class":"button star",next:"MainMenuIntro.clicked",style:{left:this.buttonPosition.x,top:this.buttonPosition.y-45}});!0==this.fromMenu&&(this.fromMenu=!1,a.player.options.next="",a.player.start(),this._updateUserProgress())}.protect()});var ModulePlayer=new Class({Implements:[Options,Events],options:{parent:null,id:"",title:"",score:0,currentSequenceID:"1"},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.sequences=null;this.addEvent("DATA",this.handleDataEvent);this.addEvent("SEQUENCE",this.handleSequenceEvent);this._setupData()},myParent:function(){return this.options.parent},_setupData:function(){this.dataLoader=new DataLoader(this,{src:"media/xml/"+this.options.id+".xml",next:"data.ready"});this.dataLoader.start()},
handleDataEvent:function(a){switch(a.next){case "data.ready":this.sequences=a.data,this.myParent().fireEvent("MODULE",{next:"module.ready"})}},handleSequenceEvent:function(a){switch(a.next){case "sequence.repeat":this.playSequence(this.options.currentSequenceID);break;case "sequence.next":this.getModuleSequenceIDs();a=userTracker.getUnfinishedSequences(this.options.id);log("******** unfinished:",a);0==a.length?this.myParent().fireEvent("MODULE",{next:"module.finished"}):(this.options.currentSequenceID=
!0==sequencePlayer.fromMenu?0:a[0].id,log("Next unfinished ID:",this.options.currentSequenceID),this.playSequence(this.options.currentSequenceID));break;case "sequence.exit":this.myParent().fireEvent("MODULE",{next:"module.exit"});break;case "module.selected":this.myParent().fireEvent("MODULE",{next:"module.start"})}},getModuleSequenceIDs:function(){return null!=this.sequences?this.sequences.getKeys():[]},playSequence:function(a){this.options.currentSequenceID=a;null==sequencePlayer?sequencePlayer=
new SequencePlayer(this,{}):(sequencePlayer.reset(),sequencePlayer.options.parent=this);var b=this.sequences[this.options.currentSequenceID];"concentration"==this.options.id&&(a=userTracker.getConcentrationLevel(parseInt(a)),sequencePlayer.conLevel<a&&(sequencePlayer.playConLevelAudio=!0),sequencePlayer.conLevel=a);sequencePlayer.start(b)},getModuleInfo:function(){return{moduleID:this.options.id,moduleTitle:this.options.title,currentSequenceID:this.options.currentSequenceID,sequences:this.sequences}}});var KeyRiskPlayer=new Class({Implements:[Options,Events],options:{data:null,id:"KeyRiskPlayer",parent:null,next:""},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.container=null;this.containerID="container_"+this.options.id;this.targets=[];this.addEvent("TIMELINE",this.handleNavigationEvent);this.score=0},myParent:function(){return this.options.parent},show:function(){},hide:function(){},add:function(a,b){null==this.container&&(this.container=new Element("div",{id:this.containerID,
styles:this.options.style}),this.container.inject($(a),b));this._prepareAreas();this.myParent().activeVideo.container.addEvent("click",function(a){this.fireEvent("TIMELINE",{type:"risk.clicked",id:this.options.id,next:"risk.selected",_x:a.page.x,_y:a.page.y})}.bind(this))},remove:function(){this.hide();this.container.destroy();this.containerID=this.container=null},stop:function(){},getScore:function(){return this.score/this.options.data.areas.length},handleNavigationEvent:function(a){switch(a.next){case "Image.Ready":a=
this.draggables.every(function(a){return!0==a.options.loaded});log("Ready: ",a);!0==a&&this._showDraggables();break;case "shape.clicked":log("Shape clicked ID: "+a.id,a);!1==a.element.retrieve("selected")&&(this.score++,a.element.store("selected",!0));break;case "risk.selected":var b=document.getElementById(driveSmartDivID),b=getPos(b),c=this.myParent().options.imageFolder+"keyrisks/selected_risk.png";this.risk_image=new ImagePlayer(this,{src:c,next:"",title:"Risk",id:"Risk",style:{left:a._x-b.x-
30,top:a._y-b.y-30}});this.risk_image.preload();this.risk_image.add(this.myParent().activeVideo.containerID);this.risk_image.display();this.risk_image.tween("0","1",4,"opacity",100)}},_prepareAreas:function(){var a=this.options.data.areas;log("Areas:",a);Array.each(a,function(a){a.player=new Shape(this,a);a.player.add(this.containerID);a.player.show();this.targets.push(a.player.shape);a.player.shape.store("selected",!1)}.bind(this))}});var swiffLoaded=null,SwiffPlayer=new Class({Implements:[Options,Events],options:{swiff:{id:"Swiff",width:"640px",height:"480px",params:{allowScriptAccess:"always",wmode:"transparent"},callBacks:{isReady:this.isReady},container:null},style:{position:"absolute",top:"0px",left:"0px",opacity:"0",visibility:"hidden"},src:"",id:"element.id",next:"next.action",loaded:!1,parent:null,parentTag:driveSmartDivID},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.containerID="swiff_container";
swiffLoaded=this.swiff=this.container=null},myParent:function(){return this.options.parent},add:function(a,b){document.getElementById(a);null==this.container&&(this.container=new Element("div",{id:this.containerID,styles:this.options.style}),this.container.inject($(a),b));!0==isFlashSupported()?(this.options.swiff.container=this.container,this.swiff=new Swiff(this.options.src,this.options.swiff),RightClick.init(this.options.swiff.id,this.containerID)):(log("********************* No FLASH loading image"),
this.options.swiff.container=this.container,this.swiff=new ImagePlayer(this,{src:this.options.parent.options.imageFolder+"commentary/noflash.png",next:"NoFlash.Ready",title:"NoFlash",id:"NoFlash",style:{left:"15px",top:"15px"}}),this.addEvent("TIMELINE",this.handleNavigationEvent),this.swiff.preload())},handleNavigationEvent:function(a){switch(a.next){case "NoFlash.Ready":this.removeEvents("TIMELINE"),log("ImageNo Flash loaded"),this.swiff.add(this.container.id),this.swiff.show()}},show:function(){this.container.fade("in")},
display:function(){this.container.fade("show")},start:function(){log("***************************** Calling Start");Swiff.remote(this.swiff.toElement(),"startSwiff",1,1,1)},startConActivity:function(a){Swiff.remote(this.swiff.toElement(),"startSwiff",a.Ex,a.level,a.format)},hide:function(){null!=this.container&&!0==this.container.isVisible()&&this.container.fade("out")},remove:function(){null!=this.container&&void 0!=this.container&&this.container.destroy()},getLoaderInfo:function(){var a={},b=0;
!0==this.options.loaded&&(b=1);a[this.options.id]={progress:b,weight:1,ref:this,type:"FLASH"};return a},preload:function(){swiffLoaded=function(){this.options.loaded=!0;null!=this.myParent().mediaLoader&&void 0!=this.myParent().mediaLoader&&this.myParent().mediaLoader.reportProgress(this.getLoaderInfo());this.myParent().fireEvent("TIMELINE",{type:"swiff.ready",id:this.options.id,next:this.options.next});this.container.setStyles({visibility:"hidden"})}.bind(this);this.add(driveSmartDivID);this.container.setStyles({visibility:"visible"})}});var Modules=new Class({Implements:[Options,Events],options:{moduleID:"main_menu",sequenceID:"1",id:"Modules"},initialize:function(a){this.setOptions(a);this.modules=new Hash},start:function(){this.addEvent("MODULE",this.handleNavigationEvent);this.setupModules()},setupModules:function(){this.listOfModulesCounter=0;(new Hash({main_menu:{score:0,title:"Dashboard",id:"main_menu",sequenceID:"1"},concentration:{score:0,title:"Concentration",id:"concentration",sequenceID:"1"},kaps:{score:0,title:"Keep ahead & play safe",
id:"kaps",sequenceID:"1"},scanning:{score:0,title:"Scanning",id:"scanning",sequenceID:"1"},country:{score:0,title:"Country driving",id:"country",sequenceID:"1"},urban:{score:0,title:"Urban driving",id:"urban",sequenceID:"1"}})).each(function(a,b){this.listOfModulesCounter++;var c={};c[b]=new ModulePlayer(this,{id:b,score:a.score,title:a.title,currentSequenceID:a.sequenceID});this.modules.extend(c)}.bind(this))},handleNavigationEvent:function(a){switch(a.next){case "module.ready":this.listOfModulesCounter--;
0===this.listOfModulesCounter&&(this._setupUser(),log("Modules READY"),this._startMainMenu());break;case "module.exit":this._startMainMenu();break;case "module.finished":log("Module Finished");this._startMainMenu();break;case "module.start":sequencePlayer.fromMenu=!0,this.modules.get(this.options.moduleID).fireEvent("SEQUENCE",{type:"sequence.event",next:"sequence.next"}),this._setupDebug()}},_setupUser:function(){userTracker=new User(this,{});userTracker.setDefaultUserData(this.modules);userTracker.loadProgress()},
_startMainMenu:function(){this.modules.get("main_menu").playSequence("1")},_setupDebug:function(){var a=$("debugContainer");if(null==a){a=new Element("div",{id:"debugContainer"});a.inject(driveSmartDivID,"before");var b=new Element("select",{events:{change:function(){var a=b.options[b.selectedIndex].value,c=this.modules.get(a);log("Selected Module: "+a);this._populateSequenceSelector(g,c)}.bind(this)}}),c=new Element("option",{value:"concentration",html:"Concentration"});c.inject(b);c=new Element("option",
{value:"country",html:"Country driving"});c.inject(b);c=new Element("option",{value:"urban",html:"Urban driving"});c.inject(b);c=new Element("option",{value:"scanning",html:"Scanning"});c.inject(b);c=new Element("option",{value:"kaps",html:"Keeping ahead & play safe"});c.inject(b);c=new Element("option",{value:"main_menu",html:"Main menu"});c.inject(b);var c=new Element("button",{html:"Start",id:"debug",styles:{},events:{click:function(){var a=b.options[b.selectedIndex].value,c=this.modules.get(a),
e=g.options[g.selectedIndex].value;log("Selected Module: "+a);c.playSequence(e)}.bind(this)}}),e=new Element("button",{html:"Skip",id:"debug.skip",styles:{},events:{click:function(){var a=sequencePlayer.currentStep.attributes.fmt;null!=sequencePlayer&&null!=sequencePlayer.activeVideo&&sequencePlayer.activeVideo.skip();"ConIntro"==a&&sequencePlayer.fireEvent("TIMELINE",{type:"swiff.done",id:"intro",next:"ConIntro.done.clicked"})}.bind(this)}}),f=this.modules.get(this.options.moduleID);b.inject(a);
b.value=this.options.moduleID;var g=new Element("select",{});this._populateSequenceSelector(g,f);g.inject(a);g.value=this.options.sequenceID;c.inject(a);e.inject(a)}},_populateSequenceSelector:function(a,b){a.empty();var c=b.getModuleSequenceIDs();Array.each(c,function(b){(new Element("option",{value:b,html:b})).inject(a)})}});var User=new Class({Implements:[Options,Events],options:{ready:!1,parent:null},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.defaultData=new Hash({});this.userData=null;log("defaultData 1 ",this.defaultData);this.concentrationLevel=1},loadProgress:function(){var a=Cookie.read("userProgress"),b=lzw_decode(a),c=JSON.decode(b);log("Read Cookie: ",a,b,c);null==c?(this.userData=new Hash(this.defaultData),log("No User Data saved - Default user progress")):(this.userData=new Hash(c),
log("Loaded user progress"));log(" this.userData",this.userData)},saveProgress:function(){log("Saving: ",this.userData);var a=JSON.encode(this.userData),a=lzw_encode(a);Cookie.write("userProgress",a,{duration:7})},setDefaultUserData:function(a){a.each(function(a,c){a.getModuleInfo();var e=a.sequences.getKeys(),f=[];Array.each(e,function(c){var d=a.sequences.get(c);c=Object({id:parseInt(c),completed:!1,score:[],trackProgress:d.trackProgress,trackScore:d.trackScore});f.push(c)});e=new Hash;f.sortOn("id",
Array.NUMERIC);e.set(c,f);this.defaultData.extend(e)}.bind(this))},updateSequenceProgress:function(a){var b=a.moduleID,c=Object.subset(a,["id","completed","score"]),b=this.userData.get(b).filter(function(b){return b.id==a.id});1<b.length&&log("ERROR");Object.append(b[0],c);log("userSequence[0]: ",b[0],c);log("*** User data :",this.userData);log("Total score: ",this.getTotalScore());this.saveProgress()},getUnfinishedSequences:function(a){a=this.userData.get(a).filter(function(a){return!1==a.completed});
0==a.length&&log("Module is Finished");return a},getModuleProgress:function(a){a=this.userData.get(a);var b=a.filter(function(a){return!1==a.completed&&!0==a.trackProgress}),c=a.filter(function(a){return!1==a.trackProgress}),e={};e.total=a.length-c.length;e.finishedCount=e.total-b.length;e.progress=0==e.finishedCount?0:100*(e.finishedCount/e.total);e.total==e.finishedCount&&(e.completed=!0);return e},getTotalScore:function(){var a=this.userData.getKeys(),b=[];Array.each(a,function(a){this.getModuleScore(a)!=
[]&&b.push(this.getModuleScore(a))}.bind(this));return b.average()},getModuleScore:function(a){var b=this.userData.get(a),c=[];Array.each(b,function(a){0!=a.id&&(c=c.concat(a.score))});b=c.average();log("Module "+a+" score: ",b);return b},getConcentrationLevel:function(a){var b=this.userData.get("concentration");log("From:",a-6," To:",a+1);var c=b.filter(function(b){return parseInt(b.id)<a+1&&parseInt(b.id)>a-6});log(b);var e=[];Array.each(c,function(a){e=e.concat(a.score)});b=e.average();log("Sequence "+
a+" score: ",b);85<=b&&(log("*********** LEVEL INCREASE ***********:"+b),4>this.concentrationLevel&&this.concentrationLevel++);return this.concentrationLevel}});var Questions=new Class({Implements:[Options,Events],options:{style:{position:"absolute",top:"0px",left:"0px","background-color":"#464646","float":"left","border-radius":"1em 1em 1em 1em","text-align":"left",padding:"8px 8px 8px 8px","font-family":"Arial","-moz-border-radius":"0.5em 0.5em 0.5em 0.5em",background:"rgba(0, 0, 0, 0.6)",width:"550px",opacity:"0",visibility:"hidden"},data:["Q1","Q2","Q3"],id:"element.id",next:"next.action",responses:1,correct:null,parent:null},initialize:function(a,b){this.setOptions(b);
this.options.parent=a;this.checkBoxes=[];this.selectedCheckBoxes=[];this.panel=new Element("div",{id:"questionPanel"});Array.each(this.options.data,function(a,b){var f=new Element("input",{type:"checkbox",id:"item_"+b,group:"questionPanel",name:"question_item"});f.addEvent("click",function(){this._checkMaxSelects(f)}.bind(this));this.checkBoxes.push(f);var g=new Element("label",{"for":"item_"+b,html:a.text,id:"item_label_"+b});g.setStyles({color:"#FFFFFF",display:"block","margin-left":"18px"});var d=
new Element("p",{});d.adopt(f);d.adopt(g);this.panel.adopt(d)}.bind(this))},myParent:function(){return this.options.parent},add:function(a,b){var c=document.getElementById(a).getElement("div[id=panelContainer]");null==c&&(c=new Element("div",{id:"panelContainer"}),c.inject($(a),b));c.adopt(this.panel);this.panel.inject(c);this.panel.setStyles(this.options.style);this.panel.addEvent("click",function(){this.myParent().fireEvent("TIMELINE",{type:"panel.clicked",id:this.options.id,next:this.options.next})}.bind(this))},
remove:function(){this.hide();this.panel.destroy();$("panelContainer").destroy()},show:function(){0==this.panel.style.opacity&&this.panel.fade("in")},hide:function(){0<this.panel.style.opacity&&this.panel.fade("out")},lockAnswer:function(){Array.each(this.options.data,function(a,b){document.getElementById("item_label_"+b);document.getElementById("item_"+b).set("disabled",!0)})},showCorrect:function(){var a=0,b=0;Array.each(this.options.data,function(c,e){var f=document.getElementById("item_label_"+
e),g=document.getElementById("item_"+e);g.set("disabled",!0);!1==c.correct?f.setStyles({color:"#CCCCCC"}):f.setStyles({color:"#00FF00","font-weight":"bold"});!0==c.correct&&(b++,!0==g.checked&&a++)}.bind(this));return a/b},_checkMaxSelects:function(a){a.checked?(this.selectedCheckBoxes.unshift(a),this.selectedCheckBoxes.length>this.options.responses&&(this.selectedCheckBoxes.pop().checked=!1)):this.selectedCheckBoxes.erase(a)}});var MenuItems=new Class({Implements:[Options,Events,Tips],options:{style:{position:"absolute",top:"0px",left:"0px",opacity:"0",visibility:"hidden"},data:null,id:"element.id",next:"next.action",correct:null,parent:null,text:function(a){return a.get("rel")}},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.menuItems=[];this.container=new Element("div",{id:"navigation.container"});Array.each(this.options.data,function(b,e){var f=new Element("div",{html:b.text,id:"menu_item_"+e,
onselectstart:"return false;",rel:b.description,"class":"dashboard_modules"});this.menuItems.push(f);var g=new ImagePlayer(a,{src:a.options.imageFolder+b.preview,title:"Image",id:"preview_"+e,style:{width:"140px",height:"107px",top:"60px",left:"380px"}});g.preload();f.store("preview",g);var d=b.moduleID;f.addEvent("click",function(){this.myParent().fireEvent("TIMELINE",{type:"item.clicked",id:d,next:"Menu.item.clicked"})}.bind(this));f.addEvent("mouseenter",function(){this.module_description.set("html",
this.options.text(f));this.module_description.show();var a=f.retrieve("preview"),b=this.container.getElementById("imageContainer");null!=b&&b.destroy();a.add(this.container.id);a.container.set("class","module-preview");a.display()}.bind(this));f.addEvent("mouseleave",function(){f.retrieve("preview")}.bind(this));!0==b.showProgress&&(!0==userTracker.getModuleProgress(b.moduleID).completed&&(g=this.showCompleteStatus(),f.adopt(g),g.show(),g.setStyles({width:"30px","float":"right","padding-left":"15px"})),
f.adopt(moduleProgressSetup(b.moduleID)));this.container.adopt(f)}.bind(this));this.module_description=new Element("div",{id:"module.description","class":"module-description",styles:{left:"375px",top:"190px"}});this.container.adopt(this.module_description);this.module_description.hide()},myParent:function(){return this.options.parent},add:function(a){this.container.inject($(a));this.container.setStyles(this.options.style)},remove:function(){this.hide();this.container.destroy()},show:function(){0==
this.container.style.opacity&&this.container.fade("in")},hide:function(){0<this.container.style.opacity&&this.container.fade("out")},showCompleteStatus:function(){var a=this.myParent().options.imageFolder+"menu/tick.png",a=new ImagePlayer(this,{src:a,next:"",title:"finished",id:"finished"});a.preload();return a.image}});var Shape=new Class({Implements:[Options,Events],options:{data:"legacy#167:131:77:82,3:254:168:69,327:214:79:26,390:239:103:47",type:"legacy",id:"shape",parent:null,next:"shape.clicked",svgStyle:{fill:"lime",opacity:"0"},shapeStyle:{left:"0px",top:"0px",position:"absolute"}},initialize:function(a,b){this.setOptions(b);this.options.parent=a;var c=this.options.data;log("Data:",this.options,b);c=c.split("#");this.options.type=c[0];null==this.options.type&&log("ERROR: no type defined for svg data");this.shapes=
[];this.shapesArray=[];this.container=null;this.containerID="container_shape"+this.options.id;this.shapes.push(c[1]);log(this.shapes)},myParent:function(){return this.options.parent},show:function(){},hide:function(){},draw:function(){},add:function(a){var b=document.getElementById(a);log(b);b=b.getElement("div[id="+this.containerID+"]");null==b?(this.container=b=new Element("div",{id:this.containerID}),this._svgTags(["svg","polygon","polyline","rect","path"]),this.shapeWrapper=new Element("svg",
{id:this.options.id,xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"640px",height:"480px"}),this.shapeWrapper.inject(this.container)):(this.container=b,this.shapeWrapper=this.container.getElement("svg[id="+this.options.id+"]"));this.shape=null;Array.each(this.shapes,function(a,b){var f="shape_"+b,g=new Element("path",{d:a,id:this.options.id});g.inject(this.shapeWrapper);g.setStyles(this.options.svgStyle);g.addEvent("click",function(a){this.myParent().fireEvent("TIMELINE",{type:"shape.event",
id:f,next:this.options.next,element:g,_x:a.page.x,_y:a.page.y})}.bind(this));this.shape=g}.bind(this));b.setStyles(this.options.shapeStyle);b.inject($(a))},remove:function(){this.container.destroy();this.container=null},_svgTags:function(a){var b=Element.prototype,c=Element,e={},f;for(f in b)c.hasOwnProperty(f)&&(e[f]=b[f]);a.each(function(a){Element.Constructors[a]=function(b){return Object.append(document.createElementNS("http://www.w3.org/2000/svg",a),e).set(b)}})},isInside:function(a,b){for(var c=
!1,e=-1,f=a.length,g=f-1;++e<f;g=e)(a[e].y<=b.y&&b.y<a[g].y||a[g].y<=b.y&&b.y<a[e].y)&&b.x<(a[g].x-a[e].x)*(b.y-a[e].y)/(a[g].y-a[e].y)+a[e].x&&(c=!c);return c}});var Recorder=new Class({Implements:[Options,Events],options:{swiff:{id:"Recorder",width:"640px",height:"200px",params:{allowScriptAccess:"always",wmode:"transparent"},callBacks:{isReady:this.isReady},container:null},style:{position:"absolute"},src:"media/flash/commentary.swf",id:"element.id",next:"next.action",loaded:!1,parent:null,parentTag:driveSmartDivID},initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.containerID="recorderContainer";this.swiff=this.container=null},myParent:function(){return this.options.parent},
add:function(a,b){document.getElementById(a);null==this.container&&(this.container=new Element("div",{id:this.containerID,styles:this.options.style}),this.container.inject($(a),b));!0==isFlashSupported()?(this.options.swiff.container=this.container,this.swiff=new Swiff(this.options.src,this.options.swiff)):(log("********************* No FLASH loading image"),this.options.swiff.container=this.container,this.swiff=new ImagePlayer(this,{src:this.options.parent.options.imageFolder+"commentary/noflash.png",
next:"NoFlash.Ready",title:"NoFlash",id:"NoFlash",style:{left:"15px",top:"15px"}}),this.addEvent("TIMELINE",this.handleNavigationEvent),this.swiff.preload())},handleNavigationEvent:function(a){switch(a.next){case "NoFlash.Ready":this.removeEvents("TIMELINE"),log("ImageNo Flash loaded"),this.swiff.add(this.container.id),this.swiff.show()}},show:function(){this.container.fade("in")},display:function(){this.container.fade("show")},hide:function(){!0==this.container.isVisible()&&this.container.fade("out")},
remove:function(){this.hide();this.container.destroy();this.container=this.swiff=null},getLoaderInfo:function(){var a={},b=0;!0==this.options.loaded&&(b=1);a[this.options.id]={progress:b,weight:1,ref:this,type:"FLASH"};return a},preload:function(){this.image=new Asset.flash(this.options.src,{style:this.options.style,id:this.options.id,onLoad:function(){this.options.loaded=!0;this.myParent().mediaLoader.reportProgress(this.getLoaderInfo());this.myParent().fireEvent("TIMELINE",{type:"image.ready",id:this.options.id,
next:this.options.next})}.bind(this)})},stopRecording:function(){!0==isFlashSupported()&&Swiff.remote(this.swiff.toElement(),"recordStop")},startRecording:function(){!0==isFlashSupported()&&Swiff.remote(this.swiff.toElement(),"recordStart")},startPlayback:function(){!0==isFlashSupported()&&Swiff.remote(this.swiff.toElement(),"playBack")}});(function(){var a=this;(a.XML2Object=new Class({Implements:[Events],$xml:null,$json:null,$store:null,initialize:function(){this.$xml="";this.$json={};this.$store={};if(instanceOf(a.XML2Object.$instance,a.XML2Object))return a.XML2Object.$instance;a.XML2Object.$instance=this;return this},$recursive_traverse:function(a){var c={};this.$has_attributes(a)&&Array.each(this.$get_node_attributes(a),function(a){c[this.$get_node_name(a)]=this.$get_node_value(a)},this);var e=[];this.$has_childNodes(a)&&Array.each(this.$get_childElements(a),
function(a){a=this.$recursive_traverse(a);e.append([a])},this);var f=this.$get_node_value(a);Type.isString(f)&&(f=f.split("\n")[0]);return{name:this.$get_node_name(a),value:f,attributes:c,childNodes:e}},$get_document_rootNode:function(){return this.$xml.documentElement},$get_node_name:function(a){return a.nodeName}.protect(),$get_node_value:function(a){var c="";switch(this.$get_node_type(a)){case 1:c=a.textContent||a.innerText||a.nodeValue||a.text;break;default:c=a.nodeValue}c=null!==Number.from(c)?
Number.from(c):c;c="true"===c?!0:c;return"false"===c?!1:c}.protect(),$get_node_type:function(a){return a.nodeType}.protect(),$has_childNodes:function(a){return!!a.childNodes&&0!=a.childNodes.length}.protect(),$get_node_children:function(a){return this.$has_childNodes(a)?a.childNodes:null}.protect(),$get_childElements:function(a){a=this.$get_node_children(a);return a=this.$filter_byType(a,1)},$has_attributes:function(a){return!!a.attributes&&0!=a.attributes.length}.protect(),$get_node_attributes:function(a){return this.$has_attributes(a)?
a.attributes:null}.protect(),$get_attribute:function(a,c){return this.$has_attributes(a)?a.getAttribute(c):null}.protect(),$collection_toArray:function(a){var c=[];Array.each(a,function(a){1==this.$get_node_type(a)&&c.append([a])},this);return c}.protect(),$filter_byType:function(a,c){c=Type.isNumber(c)?c:1;var e=this.$xml.createElement("filteredNodes");for(i=0;i<a.length;i++)if(a[i].nodeType==c){var f=a[i].cloneNode(!0);e.appendChild(f)}return e.childNodes}.protect(),$get_fromPath:function(a,c){for(var e=
c.split("."),f=0,g=e.length;f<g;f++)if(a.hasOwnProperty(e[f]))a=a[e[f]];else return null;return a},$append_toPath:function(a,c,e){c=key.split(".");for(var f=a,g=0,d=c.length;g<d;g++){if(g<d-1&&(!a.hasOwnProperty(c[g])||!Type.isObject(a[g])))a[c[g]]={};g==d-1?a[c[g]]=e:a=a[c[g]]}return f},$storeResult:function(a,c){Type.isString(a)&&Type.isObject(c)&&(this.$store[a]=c)},convertFromString:function(a,c){var e;window.DOMParser?(e=new DOMParser,e=e.parseFromString(a,"text/xml")):Browser.ie&&(e=new ActiveXObject("Microsoft.XMLDOM"),
e.async=!1,e=e.loadXML(a));this.$xml=e;e=this.$get_document_rootNode();e=this.$json=this.$recursive_traverse(e);this.$storeResult(c,e);return e},toString:function(a,c){return this.convertFromString(a,c)},convertFromURL:function(a,c,e,f){e=e||{};a={method:"get",url:a,noCache:!0};Object.merge(a,e,{onSuccess:function(a,b){this.$xml=b;var e=this.$get_document_rootNode(),e=this.$json=this.$recursive_traverse(e);this.$storeResult(f,e);c.call(this,e)}.bind(this)});return(new Request(a)).send()},retrieve:function(a){return this.$store.hasOwnProperty(a)?
this.$store[a]:null},remove:function(a){if(this.$store.hasOwnProperty(a))this.$store[a]=null;else return null}})).extend({$instance:null})})(document.id);var RightClick={init:function(a,b){this.FlashObjectID=a;this.FlashContainerID=b;this.Cache=this.FlashObjectID;window.addEventListener?(document.oncontextmenu=function(a){RightClick.killEvents(a)},window.addEventListener("mousedown",this.onGeckoMouse,!0)):(document.oncontextmenu=function(){if(window.event.srcElement.id==RightClick.FlashObjectID)return!1;RightClick.Cache="nan"},document.getElementById(this.FlashContainerID).onmouseup=function(){document.getElementById(RightClick.FlashContainerID).releaseCapture()},
document.getElementById(this.FlashContainerID).onmousedown=RightClick.onIEMouse)},killEvents:function(a){a&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.preventCapture&&a.preventCapture(),a.preventBubble&&a.preventBubble())},onGeckoMouse:function(a){0!=a.button&&(RightClick.killEvents(a),a.target.id==RightClick.FlashObjectID&&RightClick.Cache==RightClick.FlashObjectID&&RightClick.call(),RightClick.Cache=a.target.id)},onIEMouse:function(){1<event.button&&(window.event.srcElement.id==
RightClick.FlashObjectID&&RightClick.Cache==RightClick.FlashObjectID&&RightClick.call(),document.getElementById(RightClick.FlashContainerID).setCapture(),window.event.srcElement.id&&(RightClick.Cache=window.event.srcElement.id))},call:function(){document.getElementById(this.FlashObjectID).rightClick&&document.getElementById(this.FlashObjectID).rightClick()}};var Draggable=new Class({Extends:ImagePlayer,Implements:[Options,Events],initialize:function(a,b){this.setOptions(b);this.options.parent=a;this.containerID="draggableImageContainer";this.container=null;this.drags=[];Drag.Move.implement({getDroppableCoordinates:function(a){var b=a.getBBox(),f={};f.left=b.x;f.top=b.y;f.bottom=b.y+b.height;f.right=b.x+b.width;"fixed"==a.getStyle("position")&&(a=window.getScroll(),f.left+=a.x,f.right+=a.x,f.top+=a.y,f.bottom+=a.y);return f},checkDroppables:function(){var a=
this.getOvered().getLast();this.overed!=a&&(this.overed&&this.fireEvent("leave",[this.element,this.overed]),a&&this.fireEvent("enter",[this.element,a]),this.overed=a)},getOvered:function(){var a=document.getElementById(driveSmartDivID),b=getPos(a);return this.droppables.filter(function(a,c){a=this.positions?this.positions[c]:this.getDroppableCoordinates(a);var d=getPos(this.element),h;h=d.x-b.x+this.element.get("width")/2;d=d.y-b.y+this.element.get("width")/2;return h>a.left&&h<a.right&&d<a.bottom&&
d>a.top},this)},isCorrect:function(a){var b=document.getElementById(driveSmartDivID),f=getPos(b);zoneCoords=this.getDroppableCoordinates(a);var g=getPos(this.element),b=g.x-f.x+this.element.get("width")/2,f=g.y-f.y+this.element.get("width")/2;log("zone:",a,this.element,a.retrieve("correct"));b=b>zoneCoords.left&&b<zoneCoords.right&&f<zoneCoords.bottom&&f>zoneCoords.top;(b=!0==(this.element.id==a.retrieve("correct"))&&!0==b&&!0!=a.retrieve("marked"))&&a.store("marked",!0);return b},_rotate:function(a,
b){a.setStyles({transform:"rotate("+b+"deg)",msTransform:"rotate("+b+"deg)","-webkit-transform":"rotate("+b+"deg)","-moz-transform":"rotate("+b+"deg)","-o-transform":"rotate("+b+"deg)"})},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);this.element.set("class","non-draggable");this.element.set("onselectstart","return false;");return this}})},_addEvents:function(){this.topViewImage=new Asset.image(this.options.src_top,{id:this.options.id,onLoad:function(){this.image.addEvent("mousedown",
function(a){var b={left:this.options.style.left,top:this.options.style.top,position:"absolute"},c=this.topViewImage.clone();c.set("id",this.options.id);c.setStyles(b);this._addDragEvents(c);c.inject(this.container);c.fireEvent("mousedown",a)}.bind(this))}.bind(this)})},stop:function(){Array.each(this.drags,function(a){a.detach()});this.image.removeEvents();this.image.set("class","non-draggable")},_addDragEvents:function(a){var b=a.get("width")/2,c=a.get("height")/2,b=new Drag.Move(a,{precalculate:!1,
limit:{x:[0-b,640-b],y:[0-c,480-c]},includeMargins:!1,droppables:this.options.droppables,onStart:function(){},onEnter:function(a,b){var c=b.retrieve("angle");this._rotate(a,c)},onLeave:function(a,b){console.log(a,"left",b);this._rotate(a,0)},onSnap:function(){},onComplete:function(b,c){log("Stopped dragging",b,c);a.set("class","draggable")},onBeforeStart:function(){a.set("class","dragging")},onDrag:function(){},onCancel:function(){},onDrop:function(a,b){null!=b&&void 0!=b&&"trash"==b.get("id")&&a.destroy()}});
this.drags.push(b)}});
